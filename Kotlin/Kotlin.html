<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">.lst-kix_sprl3mj9gukj-1>li:before{content:"\0025cb  "}.lst-kix_sprl3mj9gukj-3>li:before{content:"\0025cf  "}.lst-kix_sprl3mj9gukj-0>li:before{content:"\0025cf  "}.lst-kix_sprl3mj9gukj-4>li:before{content:"\0025cb  "}.lst-kix_sprl3mj9gukj-5>li:before{content:"\0025a0  "}.lst-kix_sprl3mj9gukj-6>li:before{content:"\0025cf  "}ul.lst-kix_y8tbqqd84uyk-0{list-style-type:none}ul.lst-kix_xs92kluqp3wu-8{list-style-type:none}ul.lst-kix_xs92kluqp3wu-7{list-style-type:none}ul.lst-kix_y8tbqqd84uyk-2{list-style-type:none}.lst-kix_sprl3mj9gukj-7>li:before{content:"\0025cb  "}ul.lst-kix_y8tbqqd84uyk-1{list-style-type:none}ul.lst-kix_y8tbqqd84uyk-4{list-style-type:none}.lst-kix_sprl3mj9gukj-8>li:before{content:"\0025a0  "}ul.lst-kix_y8tbqqd84uyk-3{list-style-type:none}ul.lst-kix_y8tbqqd84uyk-6{list-style-type:none}ul.lst-kix_xs92kluqp3wu-2{list-style-type:none}ul.lst-kix_y8tbqqd84uyk-5{list-style-type:none}ul.lst-kix_xs92kluqp3wu-1{list-style-type:none}ul.lst-kix_y8tbqqd84uyk-8{list-style-type:none}ul.lst-kix_xs92kluqp3wu-0{list-style-type:none}ul.lst-kix_y8tbqqd84uyk-7{list-style-type:none}ul.lst-kix_xs92kluqp3wu-6{list-style-type:none}ul.lst-kix_xs92kluqp3wu-5{list-style-type:none}ul.lst-kix_xs92kluqp3wu-4{list-style-type:none}ul.lst-kix_xs92kluqp3wu-3{list-style-type:none}.lst-kix_xs92kluqp3wu-8>li:before{content:"\0025a0  "}.lst-kix_y8tbqqd84uyk-0>li:before{content:"\0025cf  "}.lst-kix_y8tbqqd84uyk-1>li:before{content:"\0025cb  "}.lst-kix_xs92kluqp3wu-6>li:before{content:"\0025cf  "}.lst-kix_xs92kluqp3wu-7>li:before{content:"\0025cb  "}.lst-kix_y8tbqqd84uyk-4>li:before{content:"\0025cb  "}.lst-kix_y8tbqqd84uyk-3>li:before{content:"\0025cf  "}.lst-kix_y8tbqqd84uyk-5>li:before{content:"\0025a0  "}ul.lst-kix_7xjhn7ilybxi-8{list-style-type:none}.lst-kix_y8tbqqd84uyk-2>li:before{content:"\0025a0  "}.lst-kix_y8tbqqd84uyk-6>li:before{content:"\0025cf  "}ul.lst-kix_7xjhn7ilybxi-7{list-style-type:none}ul.lst-kix_7xjhn7ilybxi-6{list-style-type:none}ul.lst-kix_7xjhn7ilybxi-5{list-style-type:none}ul.lst-kix_7xjhn7ilybxi-4{list-style-type:none}ul.lst-kix_7xjhn7ilybxi-3{list-style-type:none}ul.lst-kix_7xjhn7ilybxi-2{list-style-type:none}ul.lst-kix_7xjhn7ilybxi-1{list-style-type:none}ul.lst-kix_7xjhn7ilybxi-0{list-style-type:none}.lst-kix_y8tbqqd84uyk-8>li:before{content:"\0025a0  "}.lst-kix_y8tbqqd84uyk-7>li:before{content:"\0025cb  "}.lst-kix_xs92kluqp3wu-1>li:before{content:"\0025cb  "}.lst-kix_xs92kluqp3wu-0>li:before{content:"\0025cf  "}.lst-kix_xs92kluqp3wu-2>li:before{content:"\0025a0  "}.lst-kix_xs92kluqp3wu-5>li:before{content:"\0025a0  "}.lst-kix_xs92kluqp3wu-4>li:before{content:"\0025cb  "}.lst-kix_xs92kluqp3wu-3>li:before{content:"\0025cf  "}.lst-kix_uoi176xygot5-5>li:before{content:"\0025a0  "}.lst-kix_uoi176xygot5-6>li:before{content:"\0025cf  "}.lst-kix_uoi176xygot5-7>li:before{content:"\0025cb  "}.lst-kix_uoi176xygot5-8>li:before{content:"\0025a0  "}ul.lst-kix_kadi11qotg3-3{list-style-type:none}.lst-kix_kadi11qotg3-4>li:before{content:"\0025cb  "}ul.lst-kix_kadi11qotg3-2{list-style-type:none}ul.lst-kix_kadi11qotg3-5{list-style-type:none}ul.lst-kix_kadi11qotg3-4{list-style-type:none}ul.lst-kix_kadi11qotg3-7{list-style-type:none}ul.lst-kix_kadi11qotg3-6{list-style-type:none}.lst-kix_kadi11qotg3-3>li:before{content:"\0025cf  "}.lst-kix_kadi11qotg3-7>li:before{content:"\0025cb  "}ul.lst-kix_kadi11qotg3-8{list-style-type:none}ul.lst-kix_uoi176xygot5-8{list-style-type:none}ul.lst-kix_uoi176xygot5-6{list-style-type:none}ul.lst-kix_uoi176xygot5-7{list-style-type:none}.lst-kix_kadi11qotg3-6>li:before{content:"\0025cf  "}.lst-kix_uoi176xygot5-4>li:before{content:"\0025cb  "}.lst-kix_kadi11qotg3-5>li:before{content:"\0025a0  "}ul.lst-kix_uoi176xygot5-0{list-style-type:none}ul.lst-kix_uoi176xygot5-1{list-style-type:none}.lst-kix_uoi176xygot5-2>li:before{content:"\0025a0  "}.lst-kix_uoi176xygot5-3>li:before{content:"\0025cf  "}ul.lst-kix_uoi176xygot5-4{list-style-type:none}.lst-kix_uoi176xygot5-1>li:before{content:"\0025cb  "}ul.lst-kix_uoi176xygot5-5{list-style-type:none}ul.lst-kix_uoi176xygot5-2{list-style-type:none}ul.lst-kix_uoi176xygot5-3{list-style-type:none}.lst-kix_kadi11qotg3-0>li:before{content:"\0025cf  "}.lst-kix_7xjhn7ilybxi-8>li:before{content:"\0025a0  "}.lst-kix_kadi11qotg3-2>li:before{content:"\0025a0  "}.lst-kix_7xjhn7ilybxi-7>li:before{content:"\0025cb  "}.lst-kix_uoi176xygot5-0>li:before{content:"\0025cf  "}.lst-kix_kadi11qotg3-1>li:before{content:"\0025cb  "}ul.lst-kix_kadi11qotg3-1{list-style-type:none}ul.lst-kix_kadi11qotg3-0{list-style-type:none}.lst-kix_7xjhn7ilybxi-4>li:before{content:"\0025cb  "}.lst-kix_7xjhn7ilybxi-5>li:before{content:"\0025a0  "}.lst-kix_7xjhn7ilybxi-2>li:before{content:"\0025a0  "}.lst-kix_7xjhn7ilybxi-6>li:before{content:"\0025cf  "}.lst-kix_7xjhn7ilybxi-3>li:before{content:"\0025cf  "}.lst-kix_kadi11qotg3-8>li:before{content:"\0025a0  "}.lst-kix_7xjhn7ilybxi-0>li:before{content:"\0025cf  "}.lst-kix_7xjhn7ilybxi-1>li:before{content:"\0025cb  "}ul.lst-kix_sprl3mj9gukj-8{list-style-type:none}ul.lst-kix_sprl3mj9gukj-6{list-style-type:none}ul.lst-kix_sprl3mj9gukj-7{list-style-type:none}ul.lst-kix_sprl3mj9gukj-4{list-style-type:none}ul.lst-kix_sprl3mj9gukj-5{list-style-type:none}ul.lst-kix_sprl3mj9gukj-2{list-style-type:none}ul.lst-kix_sprl3mj9gukj-3{list-style-type:none}ul.lst-kix_sprl3mj9gukj-0{list-style-type:none}ul.lst-kix_sprl3mj9gukj-1{list-style-type:none}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}.lst-kix_sprl3mj9gukj-2>li:before{content:"\0025a0  "}ol{margin:0;padding:0}table td,table th{padding:0}.c14{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:526.5pt;border-top-color:#000000;border-bottom-style:solid}.c6{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:500pt;border-top-color:#000000;border-bottom-style:solid}.c8{-webkit-text-decoration-skip:none;color:#1155cc;font-weight:400;text-decoration:underline;vertical-align:baseline;text-decoration-skip-ink:none;font-size:11pt;font-family:"Arial";font-style:normal}.c0{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c12{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:16pt;font-family:"Arial";font-style:normal}.c20{padding-top:18pt;padding-bottom:10pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c1{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left;height:11pt}.c18{padding-top:18pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c25{padding-top:4pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c9{padding-top:0pt;padding-bottom:10pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c22{padding-top:10pt;padding-bottom:4pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c19{padding-top:10pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c7{color:#000000;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c5{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c15{border-spacing:0;border-collapse:collapse;margin-right:auto}.c2{padding-top:0pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c23{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline}.c13{margin-left:auto;border-spacing:0;border-collapse:collapse;margin-right:auto}.c26{background-color:#ffffff;max-width:526.5pt;padding:72pt 40.5pt 72pt 45pt}.c24{padding:0;margin:0}.c11{color:inherit;text-decoration:inherit}.c16{margin-left:36pt;padding-left:0pt}.c17{margin-left:72pt;padding-left:0pt}.c10{font-style:italic}.c3{height:11pt}.c4{font-weight:700}.c21{height:0pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c26 doc-content"><p class="c1"><span class="c0"></span></p><p class="c25"><span class="c8"><a class="c11" href="#h.1wy5lej0qlse">Coroutines</a></span></p><p class="c19"><span class="c23"><a class="c11" href="#h.bfl4yhvkoxjj">Property vs Field</a></span></p><p class="c19"><span class="c8"><a class="c11" href="#h.n6aycjpkcb3c">Receiver Type</a></span></p><p class="c19"><span class="c8"><a class="c11" href="#h.7c0w9gnufsci">Trailing Lambda</a></span></p><p class="c19"><span class="c8"><a class="c11" href="#h.8y9ue27exgt">Lateinit</a></span></p><p class="c19"><span class="c8"><a class="c11" href="#h.ph9orueti64e">Data Class</a></span></p><p class="c22"><span class="c8"><a class="c11" href="#h.h6hre7dunalt">Use-site target</a></span></p><p class="c1"><span class="c0"></span></p><h2 class="c18" id="h.1wy5lej0qlse"><span class="c12">Coroutines</span></h2><p class="c9"><span>Coroutines, threads, concurrency: </span><span class="c23"><a class="c11" href="https://www.google.com/url?q=https://medium.com/androiddevelopers/bridging-the-gap-between-coroutines-jvm-threads-and-concurrency-problems-864e563bd7c&amp;sa=D&amp;source=editors&amp;ust=1657809913918497&amp;usg=AOvVaw0wrT0Mr_sn-FE7g_eY9gmt">https://medium.com/androiddevelopers/bridging-the-gap-between-coroutines-jvm-threads-and-concurrency-problems-864e563bd7c</a></span><span class="c0">&nbsp;</span></p><p class="c9"><span>The official documentation says that </span><span class="c4">coroutines</span><span>&nbsp;are lightweight threads. By lightweight, it means that creating </span><span class="c10">coroutines doesn&rsquo;t allocate new threads</span><span class="c0">. Instead, they use predefined thread pools and smart scheduling for the purpose of which task to execute next and which tasks later.</span></p><p class="c9"><span>How does it work? The Kotlin compiler will create a </span><span class="c10">state machine</span><span>&nbsp;for every suspend function that manages the coroutine&rsquo;s execution for us. It is explained here: </span><span class="c23"><a class="c11" href="https://www.google.com/url?q=https://manuelvivo.dev/suspend-modifier&amp;sa=D&amp;source=editors&amp;ust=1657809913919846&amp;usg=AOvVaw16dudchoWHt-ZtbQJeT9jz">https://manuelvivo.dev/suspend-modifier</a></span><span class="c0">&nbsp;</span></p><p class="c9"><span class="c0">&mdash;</span></p><p class="c9"><span class="c4">Suspend function</span><span>&nbsp;is a function that could be started, paused, and </span><span>resume</span><span class="c0">. One of the most important points to remember about the suspend functions is that they are only allowed to be called from a coroutine or another suspend function.</span></p><a id="t.8ed992a4a64a14e4d622452da7e0a8aece67a092"></a><a id="t.0"></a><table class="c13"><tr class="c21"><td class="c6" colspan="1" rowspan="1"><p class="c2"><span class="c0">suspend fun dotask(request: Request): Response</span></p><p class="c2"><span class="c0">{</span></p><p class="c2"><span class="c0">&nbsp; // perform the task</span></p><p class="c2"><span class="c0">}</span></p></td></tr></table><p class="c9"><span class="c0">Internally, this function gets converted by the compiler to another function without the suspend keyword with an extra parameter of the type Continuation&lt;T&gt; like below</span></p><a id="t.8ebe8f8dc0885d4730a359a0b9895bd35b3f94c4"></a><a id="t.1"></a><table class="c13"><tr class="c21"><td class="c6" colspan="1" rowspan="1"><p class="c2"><span class="c0">// internal conversion of suspend function dotask()</span></p><p class="c2"><span>fun dotask(request: Request, </span><span class="c4">continuation: Continuation</span><span class="c0">)...</span></p></td></tr></table><p class="c9"><span>The way suspend functions communicate with each other is with </span><span class="c4">Continuation</span><span>&nbsp;objects. A Continuation is just a generic </span><span class="c10">callback interface</span><span>&nbsp;with some extra information. As we will see later, it will represent the generated </span><span class="c10">state machine</span><span class="c0">&nbsp;of a suspend function.</span></p><a id="t.609a96e12571c0b53cde22d0dfb8f734f12f3b73"></a><a id="t.2"></a><table class="c13"><tr class="c21"><td class="c6" colspan="1" rowspan="1"><p class="c2"><span class="c0">interface Continuation&lt;in T&gt; {</span></p><p class="c2"><span class="c0">&nbsp; public val context: CoroutineContext</span></p><p class="c2"><span class="c0">&nbsp; public fun resumeWith(value: Result&lt;T&gt;)</span></p><p class="c2"><span class="c0">}</span></p></td></tr></table><p class="c9"><span class="c4">delay() </span><span>is a </span><span class="c10">suspend function</span><span>&nbsp;which delays coroutine for a given time </span><span class="c10">without blocking a thread</span><span class="c0">, and resumes it after a specified time.</span></p><p class="c9"><span class="c0">&mdash;</span></p><p class="c9"><span>To start a coroutine, we can use coroutine builders. </span><span class="c23"><a class="c11" href="https://www.google.com/url?q=https://kt.academy/article/cc-builders&amp;sa=D&amp;source=editors&amp;ust=1657809913925367&amp;usg=AOvVaw0zckeGUlzMDbNrm-WJm6nW">https://kt.academy/article/cc-builders</a></span><span class="c0">&nbsp;</span></p><ul class="c24 lst-kix_uoi176xygot5-0 start"><li class="c9 c16 li-bullet-0"><span class="c4">launch</span><span>&nbsp;- is used when we do not want to get the result back and is used for the operation such as updating of data, etc. Returns a job (somewhat like a thread, we can join it by calling </span><span class="c10">join()</span><span>&nbsp;which is a suspend function)</span></li><li class="c9 c16 li-bullet-0"><span class="c4">async</span><span>&nbsp;- is used to get the result back &amp; should be used only when we need the parallel execution. Returns a Deferred entity, we can obtain result by calling </span><span class="c10">await()</span><span class="c0">&nbsp;which is a suspend function.</span></li><li class="c9 c16 li-bullet-0"><span class="c4">runBlocking</span><span>&nbsp;- blocks the thread it has been started on whenever its coroutine is suspended (similar to suspending main). This means that </span><span class="c10">delay(1000L)</span><span>&nbsp;inside runBlocking will behave like </span><span class="c10">Thread.sleep(1000L)</span><span>. Unlike other coroutine builders, </span><span class="c4">runBlocking</span><span class="c0">&nbsp;is not an extension function on CoroutineScope. This means that it cannot be a child: it can only be used as a root coroutine (the parent of all the children in a hierarchy). This means that runBlocking will be used in different cases than other coroutines. As we mentioned before, this is very different from other builders</span></li></ul><p class="c9"><span>Being within already created context, we can easily supply tasks with </span><span class="c4">withContext</span><span class="c0">&nbsp;- it is a suspend function, and another way to sequentially execute tasks (pros comparing to async: doesn&rsquo;t create an extra coroutine and provides better exception handling - throws an exception instead of killing the parent context).</span></p><p class="c9"><span>The problem with </span><span class="c10">async</span><span>&nbsp;arises when we do not want to make parallel network calls. When </span><span class="c4">withContext</span><span>&nbsp;is used, it runs the tasks </span><span class="c10">in series</span><span class="c0">&nbsp;instead of parallel. So one should remember that when we have a single task in the background and want to get back the result of that task, we should use withContext.</span></p><p class="c9"><span class="c4">withContext</span><span class="c0">&nbsp;is nothing but another way of writing the async where one does not have to write await().</span></p><p class="c9"><span>Using async (without </span><span class="c4">withContext</span><span class="c0">):</span></p><a id="t.7dcbf010f6110ea660d897302a435cb972f5f1c3"></a><a id="t.3"></a><table class="c13"><tr class="c21"><td class="c6" colspan="1" rowspan="1"><p class="c2"><span class="c0">// kotlin function using async</span></p><p class="c2"><span class="c0">fun startLongRunningTaskInParallel()</span></p><p class="c2"><span class="c0">{</span></p><p class="c2"><span class="c0">&nbsp; viewModelScope.launch</span></p><p class="c2"><span class="c0">&nbsp; {</span></p><p class="c2"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val resultOneDeferred = async { TaskOne() }</span></p><p class="c2"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val resultTwoDeferred = async { TaskTwo() }</span></p><p class="c2"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val combinedResult = resultOneDeferred.await() + resultTwoDeferred.await()</span></p><p class="c2"><span class="c0">&nbsp; }</span></p><p class="c2"><span class="c0">}</span></p></td></tr></table><p class="c9"><span>Here using async, both the tasks run </span><span class="c10">in parallel</span><span class="c0">. Now let&rsquo;s use the withContext and do the same task in series with withContext.</span></p><p class="c9"><span class="c0">Using withContext:</span></p><a id="t.15038ceb63d0c10c0b8e6d75d1d90759f3a01b9f"></a><a id="t.4"></a><table class="c13"><tr class="c21"><td class="c6" colspan="1" rowspan="1"><p class="c2"><span class="c0">fun startLongRunningTaskInParallel()</span></p><p class="c2"><span class="c0">{</span></p><p class="c2"><span class="c0">&nbsp; viewModelScope.launch</span></p><p class="c2"><span class="c0">&nbsp; {</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #withContext returns not the Deferred but the result itself; these two calls run sequentially</span></p><p class="c2"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val resultOne = withContext(Dispatchers.IO) { TaskOne() }</span></p><p class="c2"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val resultTwo = withContext(Dispatchers.IO) { TaskTwo() }</span></p><p class="c2"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val combinedResult = resultOne + resultTwo</span></p><p class="c2"><span class="c0">&nbsp; }</span></p><p class="c2"><span class="c0">}</span></p></td></tr></table><p class="c9 c3"><span class="c0"></span></p><p class="c9"><span class="c4">withContext</span><span class="c0">() a simpler and more direct API, especially in terms of exception handling:</span></p><ul class="c24 lst-kix_7xjhn7ilybxi-0 start"><li class="c9 c16 li-bullet-0"><span>An exception that isn&#39;t handled within </span><span class="c10">async</span><span class="c0">&nbsp;{ ... } causes its parent job to get canceled. This happens regardless of how you handle exceptions from the matching await(). If you haven&#39;t prepared a coroutineScope for it, it may bring down your entire application.</span></li><li class="c9 c16 li-bullet-0"><span>An exception not handled within </span><span class="c10">withContext</span><span class="c0">&nbsp;{ ... } simply gets thrown by the withContext call, you handle it just like any other.</span></li></ul><p class="c9"><span class="c0">&mdash;</span></p><p class="c9"><span>The </span><span class="c4">CoroutineDispatcher</span><span class="c0">&nbsp;is in charge of dispatching the execution of a coroutine to a thread.</span></p><p class="c9"><span class="c0">You can swap between different Dispatchers to execute computations on different threads. How does Kotlin know where to resume a suspended computation?</span></p><p class="c9"><span class="c0">There&rsquo;s a subtype of Continuation called DispatchedContinuation whose resume function makes a dispatch call to the Dispatcher available in the CoroutineContext. All Dispatchers will call dispatch except Dispatchers.Unconfined whose isDispatchNeeded function override (that is called before dispatch) always returns false.</span></p><p class="c9"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 497.50px; height: 260.10px;"><img alt="" src="images/image1.png" style="width: 497.50px; height: 260.10px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c9"><span class="c0">&mdash;</span></p><p class="c9"><span class="c0">Here is an example of coroutine scoping:</span></p><a id="t.4eec6d1b9baea2b6f19aca6c03fc7ea200d9b09b"></a><a id="t.5"></a><table class="c13"><tr class="c21"><td class="c6" colspan="1" rowspan="1"><p class="c2"><span class="c0">/* kafka listener handler */</span></p><p class="c2"><span class="c0">suspend fun onMessage(msg: Message) {</span></p><p class="c2"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val ids: List&lt;Int&gt; = msg.getIds() &nbsp; &nbsp;</span></p><p class="c2 c3"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val jobs = ids.map { id -&gt;</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GlobalScope.launch { restService.post(id) }</span></p><p class="c2"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></p><p class="c2 c3"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jobs.joinAll()</span></p><p class="c2"><span class="c0">}</span></p></td></tr></table><p class="c9"><span class="c0">If one of the calls to restService.post(id) fails with an exception, the example will immediately rethrow the exception, and all the jobs that hasn&#39;t completed yet will leak. They will continue to execute (potentially indefinitely), and if they fail, you won&#39;t know about it.</span></p><p class="c9"><span class="c0">To solve this, you need to scope your coroutines. Here&#39;s the same example without the leak:</span></p><a id="t.9ca89569a70c48c6be9fefad3c35619e55d6b65e"></a><a id="t.6"></a><table class="c13"><tr class="c21"><td class="c6" colspan="1" rowspan="1"><p class="c2"><span class="c0">suspend fun onMessage(msg: Message) = coroutineScope {</span></p><p class="c2"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val ids: List&lt;Int&gt; = msg.getIds() &nbsp; &nbsp;</span></p><p class="c2 c3"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ids.forEach { id -&gt;</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // launch is called on &quot;this&quot;, which is the coroutineScope.</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; launch { restService.post(id) }</span></p><p class="c2"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></p><p class="c2"><span class="c0">}</span></p></td></tr></table><p class="c9"><span class="c0">In this case, if one of the calls to restService.post(id) fails, then all other non-completed coroutines inside the coroutine scope will get cancelled. When you leave the scope, you can be sure that you haven&#39;t leaked any coroutines.</span></p><h2 class="c18" id="h.bfl4yhvkoxjj"><span class="c12">Property vs Field</span></h2><p class="c5"><span class="c4">Field</span><span class="c0">&nbsp;is just a class member variable that hold a value. It can be read-only or mutable and marked with any access modifier such as public or private.</span></p><p class="c1"><span class="c0"></span></p><p class="c5"><span class="c4">Property</span><span class="c0">&nbsp;is a more complex element that contains a private field and accessors. By accessors I mean getter and setter. Property can also be read-only or mutable.</span></p><p class="c1"><span class="c0"></span></p><ul class="c24 lst-kix_kadi11qotg3-0 start"><li class="c5 c16 li-bullet-0"><span class="c0">read-only property = private field + getter</span></li><li class="c5 c16 li-bullet-0"><span class="c0">mutable property = private field + getter + setter</span></li></ul><p class="c1"><span class="c0"></span></p><p class="c5"><span class="c0">The following code declares the Human class with the read-only age property that contains a getter implicitly:</span></p><p class="c1"><span class="c0"></span></p><a id="t.d42e338f51e45d4ad9cbe74d9fbc1835414b05e2"></a><a id="t.7"></a><table class="c13"><tr class="c21"><td class="c6" colspan="1" rowspan="1"><p class="c5"><span class="c0">class Human {</span></p><p class="c5"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val age = 20</span></p><p class="c5"><span class="c0">}</span></p></td></tr></table><h2 class="c18" id="h.n6aycjpkcb3c"><span class="c12">Receiver Type</span></h2><p class="c9"><span class="c0">Lambda expressions can be used as function literals with receiver when the receiver type can be inferred from the context. One of the most important examples of their usage is type-safe builders:</span></p><p class="c1"><span class="c0"></span></p><a id="t.6396c1433cd83fef0cd393779904059dc0f71b46"></a><a id="t.8"></a><table class="c15"><tr class="c21"><td class="c14" colspan="1" rowspan="1"><p class="c2"><span class="c0">class HTML {</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; fun body() { ... }</span></p><p class="c2"><span class="c0">}</span></p><p class="c2 c3"><span class="c0"></span></p><p class="c2"><span>fun html(</span><span class="c4">init</span><span class="c0">: HTML.() -&gt; Unit): HTML {</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; val html = HTML() &nbsp;// create the receiver object</span></p><p class="c2"><span>&nbsp; &nbsp; html.</span><span class="c4">init</span><span class="c0">() &nbsp; &nbsp; &nbsp; &nbsp;// pass the receiver object to the lambda</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; return html</span></p><p class="c2"><span class="c0">}</span></p><p class="c2 c3"><span class="c0"></span></p><p class="c2"><span class="c0">html { &nbsp; &nbsp; &nbsp; // lambda with receiver begins here</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; body() &nbsp; // calling a method on the receiver object</span></p><p class="c2"><span class="c0">}</span></p></td></tr></table><p class="c1"><span class="c0"></span></p><h2 class="c18" id="h.7c0w9gnufsci"><span class="c12">Trailing Lambda</span></h2><p class="c9"><span class="c0">According to Kotlin convention, if the last parameter of a function is a function, then a lambda expression passed as the corresponding argument can be placed outside the parentheses:</span></p><p class="c1"><span class="c0"></span></p><a id="t.97fac9bfbeeee7c7f30f455a6dbf416f178ba1d5"></a><a id="t.9"></a><table class="c15"><tr class="c21"><td class="c14" colspan="1" rowspan="1"><p class="c2"><span class="c0">val product = items.fold(1) { acc, e -&gt; acc * e }</span></p></td></tr></table><p class="c1"><span class="c0"></span></p><p class="c5"><span>Such syntax is also known as </span><span class="c4">trailing lambda</span><span class="c0">.</span></p><p class="c5"><span class="c0">If the lambda is the only argument in that call, the parentheses can be omitted entirely:</span></p><p class="c1"><span class="c0"></span></p><a id="t.21d53f2ece1350a2798b1b552a9287f334156e18"></a><a id="t.10"></a><table class="c15"><tr class="c21"><td class="c14" colspan="1" rowspan="1"><p class="c2"><span class="c0">run { println(&quot;...&quot;) }</span></p></td></tr></table><h2 class="c18" id="h.8y9ue27exgt"><span class="c12">Lateinit </span></h2><ul class="c24 lst-kix_xs92kluqp3wu-0 start"><li class="c9 c16 li-bullet-0"><span class="c0">Using lateinit, the initial value does not need to be assigned. </span></li><li class="c9 c16 li-bullet-0"><span>At the use sites the </span><span class="c4">queueName</span><span class="c0">&nbsp;is not a nullable type, so ?. and !! are not used. </span></li><li class="c9 c16 li-bullet-0"><span class="c0">lateinit property acts as if we performed !!: it will crash the app on a null value</span></li></ul><p class="c1"><span class="c0"></span></p><p class="c5"><span class="c0">Example with Spring ConfigurationProperties:</span></p><a id="t.1c1f7046ccf9efbca126d0781ddbf8082e69603f"></a><a id="t.11"></a><table class="c15"><tr class="c21"><td class="c14" colspan="1" rowspan="1"><p class="c2"><span class="c0">@Component</span></p><p class="c2"><span class="c0">@ConfigurationProperties(&quot;kafka&quot;)</span></p><p class="c2"><span class="c0">class QueueProperties {</span></p><p class="c2 c3"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; lateinit var queueName: String</span></p><p class="c2"><span class="c0">}</span></p></td></tr></table><h2 class="c18" id="h.ph9orueti64e"><span class="c12">Data Class</span></h2><p class="c5"><span class="c0">Adds implementations of equals(), hashCode(), or toString()</span></p><p class="c1"><span class="c0"></span></p><a id="t.9e9acb57eb8361d81cbf9168640e0ee380fdeb77"></a><a id="t.12"></a><table class="c15"><tr class="c21"><td class="c14" colspan="1" rowspan="1"><p class="c2"><span class="c0">data class CustomMessage(</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; val id: String</span></p><p class="c2"><span class="c0">)</span></p></td></tr></table><p class="c1"><span class="c0"></span></p><p class="c5"><span class="c0">The compiler only uses the properties defined inside the primary constructor for the automatically generated functions. To exclude a property from the generated implementations, declare it inside the class body:</span></p><p class="c1"><span class="c0"></span></p><a id="t.6612293cfc90b00878fdb85220def6e566a9da3b"></a><a id="t.13"></a><table class="c15"><tr class="c21"><td class="c14" colspan="1" rowspan="1"><p class="c2"><span class="c0">data class Person(val name: String) {</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; var age: Int = 0</span></p><p class="c2"><span class="c0">}</span></p></td></tr></table><p class="c1"><span class="c0"></span></p><p class="c9"><span class="c0">Only the property name will be used inside the toString(), equals(), hashCode(), and copy() implementations.</span></p><p class="c9"><span class="c0">Typical Spring Service in Kotlin:</span></p><a id="t.0bba296d6097450991f68db0845afda25bb3e924"></a><a id="t.14"></a><table class="c15"><tr class="c21"><td class="c14" colspan="1" rowspan="1"><p class="c2"><span class="c0">@Service</span></p><p class="c2"><span class="c0">class CustomService(</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; private val kafkaTemplate: KafkaTemplate&lt;String, String&gt;,</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; private val objectMapper: ObjectMapper,</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; private val kafkaProperties: KafkaProperties</span></p><p class="c2"><span class="c0">) {</span></p><p class="c2 c3"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; private val log = KotlinLogging.logger {}</span></p><p class="c2 c3"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; fun send(id: String, body: MessageBodyRequest) {</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; val value = objectMapper.writeValueAsString(body)</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; val record = ProducerRecord(kafkaProperties.payrollTopicName, id, value)</span></p><p class="c2 c3"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; try {</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; kafkaTemplate.send(record)</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; } catch (e: Exception) {</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; log.error(e) { &quot;Unable to send message: $id: $value&quot; }</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; }</span></p><p class="c2"><span class="c0">}</span></p><p class="c2 c3"><span class="c0"></span></p><p class="c2 c3"><span class="c0"></span></p></td></tr></table><h2 class="c20" id="h.h6hre7dunalt"><span class="c12">Use-site target</span></h2><p class="c9"><span>Why do we need to annotate fields this way: @</span><span class="c4">field</span><span class="c0">:SerializedName(&quot;name&quot;) for this case:</span></p><a id="t.22d4aa895a69c582f671e35c202b2c11d727e339"></a><a id="t.15"></a><table class="c13"><tr class="c21"><td class="c6" colspan="1" rowspan="1"><p class="c2"><span class="c0">data class Repo(</span></p><p class="c2"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@field:SerializedName(&quot;name&quot;)</span></p><p class="c2"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var name: String</span></p><p class="c2"><span class="c0">)</span></p></td></tr></table><p class="c9"><span class="c0">That code is declaring a data class along with its properties via the primary constructor. Kotlin properties are made up of the property itself, a getter, and&mdash;if mutable&mdash;a setter. What does all this mean for us? It means there&#39;s a lot going on here for just one little property. In this context, the annotation on name could1 apply to any one of the following:</span></p><ul class="c24 lst-kix_y8tbqqd84uyk-0 start"><li class="c9 c17 li-bullet-0"><span class="c0">The constructor parameter.</span></li><li class="c9 c17 li-bullet-0"><span class="c0">The Kotlin property itself.</span></li><li class="c9 c17 li-bullet-0"><span class="c0">The getter.</span></li><li class="c9 c17 li-bullet-0"><span class="c0">The setter.</span></li><li class="c9 c17 li-bullet-0"><span class="c0">The setter&#39;s parameter.</span></li><li class="c9 c17 li-bullet-0"><span class="c0">The backing field of the property.</span></li></ul><p class="c9"><span>By using </span><span class="c4">field</span><span>:, which is known as a &quot;</span><span class="c4">use-site target</span><span class="c0">&quot;, you make it clear the annotation is applied to the backing field of the property. No more ambiguity1.</span></p><p class="c9"><span>If no use-site target is used, then Kotlin looks at the @</span><span>Target</span><span class="c0">&nbsp;meta-annotation. From there, it applies the annotation to the first valid target from </span></p><ul class="c24 lst-kix_sprl3mj9gukj-0 start"><li class="c9 c16 li-bullet-0"><span class="c0">param (constructor parameter), </span></li><li class="c9 c16 li-bullet-0"><span class="c0">property (Koltin property), </span></li><li class="c9 c16 li-bullet-0"><span class="c0">field (backing field), </span></li></ul><p class="c9"><span class="c0">, in that order. </span></p><p class="c9"><span class="c0">The @SerializedName annotation is not applicable to params. And due to it being a Java annotation, it can&#39;t possibly be applicable to properties. But the annotation is applicable to fields, and so that&#39;s where it would end up.</span></p><p class="c9 c3"><span class="c0"></span></p></body></html>