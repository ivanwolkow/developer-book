<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">.lst-kix_ng30lxb5ooyf-3>li{counter-increment:lst-ctn-kix_ng30lxb5ooyf-3}.lst-kix_ntga6soteyfy-6>li:before{content:"\0025cf  "}.lst-kix_ntga6soteyfy-5>li:before{content:"\0025a0  "}.lst-kix_ntga6soteyfy-4>li:before{content:"\0025cb  "}.lst-kix_ntga6soteyfy-2>li:before{content:"\0025a0  "}.lst-kix_ntga6soteyfy-1>li:before{content:"\0025cb  "}.lst-kix_ntga6soteyfy-3>li:before{content:"\0025cf  "}.lst-kix_ntga6soteyfy-0>li:before{content:"\0025cf  "}ol.lst-kix_ng30lxb5ooyf-2.start{counter-reset:lst-ctn-kix_ng30lxb5ooyf-2 0}ul.lst-kix_ntga6soteyfy-8{list-style-type:none}ol.lst-kix_ng30lxb5ooyf-8.start{counter-reset:lst-ctn-kix_ng30lxb5ooyf-8 0}.lst-kix_psqo3y4bcm35-0>li:before{content:"" counter(lst-ctn-kix_psqo3y4bcm35-0,decimal) ". "}.lst-kix_psqo3y4bcm35-2>li:before{content:"" counter(lst-ctn-kix_psqo3y4bcm35-2,lower-roman) ". "}.lst-kix_psqo3y4bcm35-1>li:before{content:"" counter(lst-ctn-kix_psqo3y4bcm35-1,lower-latin) ". "}ol.lst-kix_psqo3y4bcm35-4.start{counter-reset:lst-ctn-kix_psqo3y4bcm35-4 0}ul.lst-kix_ntga6soteyfy-0{list-style-type:none}ul.lst-kix_ntga6soteyfy-1{list-style-type:none}ul.lst-kix_ntga6soteyfy-2{list-style-type:none}ul.lst-kix_ntga6soteyfy-3{list-style-type:none}ol.lst-kix_ng30lxb5ooyf-1.start{counter-reset:lst-ctn-kix_ng30lxb5ooyf-1 0}ul.lst-kix_ntga6soteyfy-4{list-style-type:none}ul.lst-kix_ntga6soteyfy-5{list-style-type:none}ul.lst-kix_ntga6soteyfy-6{list-style-type:none}ul.lst-kix_ntga6soteyfy-7{list-style-type:none}.lst-kix_psqo3y4bcm35-1>li{counter-increment:lst-ctn-kix_psqo3y4bcm35-1}ol.lst-kix_ng30lxb5ooyf-7.start{counter-reset:lst-ctn-kix_ng30lxb5ooyf-7 0}.lst-kix_ng30lxb5ooyf-5>li{counter-increment:lst-ctn-kix_ng30lxb5ooyf-5}ol.lst-kix_psqo3y4bcm35-5.start{counter-reset:lst-ctn-kix_psqo3y4bcm35-5 0}.lst-kix_zef2rxoqwa2v-1>li:before{content:"\0025cb  "}.lst-kix_ng30lxb5ooyf-4>li:before{content:"" counter(lst-ctn-kix_ng30lxb5ooyf-4,lower-latin) ". "}.lst-kix_ng30lxb5ooyf-6>li:before{content:"" counter(lst-ctn-kix_ng30lxb5ooyf-6,decimal) ". "}.lst-kix_zef2rxoqwa2v-3>li:before{content:"\0025cf  "}ol.lst-kix_ng30lxb5ooyf-3.start{counter-reset:lst-ctn-kix_ng30lxb5ooyf-3 0}.lst-kix_zef2rxoqwa2v-5>li:before{content:"\0025a0  "}ol.lst-kix_psqo3y4bcm35-3.start{counter-reset:lst-ctn-kix_psqo3y4bcm35-3 0}.lst-kix_x44z2zpwa48w-8>li:before{content:"\0025a0  "}.lst-kix_psk1dptirxzv-2>li:before{content:"\0025a0  "}.lst-kix_zef2rxoqwa2v-7>li:before{content:"\0025cb  "}.lst-kix_ng30lxb5ooyf-8>li{counter-increment:lst-ctn-kix_ng30lxb5ooyf-8}ol.lst-kix_psqo3y4bcm35-8{list-style-type:none}ol.lst-kix_psqo3y4bcm35-7{list-style-type:none}ol.lst-kix_psqo3y4bcm35-6{list-style-type:none}.lst-kix_psk1dptirxzv-0>li:before{content:"\0025cf  "}.lst-kix_ng30lxb5ooyf-0>li:before{content:"" counter(lst-ctn-kix_ng30lxb5ooyf-0,decimal) ". "}.lst-kix_ng30lxb5ooyf-2>li:before{content:"" counter(lst-ctn-kix_ng30lxb5ooyf-2,lower-roman) ". "}.lst-kix_x44z2zpwa48w-6>li:before{content:"\0025cf  "}ol.lst-kix_ng30lxb5ooyf-6.start{counter-reset:lst-ctn-kix_ng30lxb5ooyf-6 0}.lst-kix_x44z2zpwa48w-0>li:before{content:"\0025cf  "}ol.lst-kix_psqo3y4bcm35-0.start{counter-reset:lst-ctn-kix_psqo3y4bcm35-0 0}.lst-kix_fd29qycifm7j-0>li:before{content:"-  "}.lst-kix_x44z2zpwa48w-4>li:before{content:"\0025cb  "}ol.lst-kix_psqo3y4bcm35-5{list-style-type:none}ol.lst-kix_psqo3y4bcm35-4{list-style-type:none}ol.lst-kix_psqo3y4bcm35-3{list-style-type:none}ol.lst-kix_psqo3y4bcm35-2{list-style-type:none}.lst-kix_x44z2zpwa48w-2>li:before{content:"\0025a0  "}ol.lst-kix_psqo3y4bcm35-1{list-style-type:none}ol.lst-kix_psqo3y4bcm35-0{list-style-type:none}.lst-kix_psk1dptirxzv-4>li:before{content:"\0025cb  "}.lst-kix_psqo3y4bcm35-3>li:before{content:"" counter(lst-ctn-kix_psqo3y4bcm35-3,decimal) ". "}.lst-kix_psqo3y4bcm35-7>li:before{content:"" counter(lst-ctn-kix_psqo3y4bcm35-7,lower-latin) ". "}.lst-kix_psqo3y4bcm35-8>li{counter-increment:lst-ctn-kix_psqo3y4bcm35-8}.lst-kix_bqo0s77nhvjl-8>li:before{content:"\0025a0  "}.lst-kix_psk1dptirxzv-6>li:before{content:"\0025cf  "}.lst-kix_psk1dptirxzv-8>li:before{content:"\0025a0  "}.lst-kix_ng30lxb5ooyf-8>li:before{content:"" counter(lst-ctn-kix_ng30lxb5ooyf-8,lower-roman) ". "}.lst-kix_psqo3y4bcm35-5>li:before{content:"" counter(lst-ctn-kix_psqo3y4bcm35-5,lower-roman) ". "}.lst-kix_ng30lxb5ooyf-6>li{counter-increment:lst-ctn-kix_ng30lxb5ooyf-6}.lst-kix_ng30lxb5ooyf-0>li{counter-increment:lst-ctn-kix_ng30lxb5ooyf-0}.lst-kix_bqo0s77nhvjl-0>li:before{content:"\0025cf  "}ul.lst-kix_fd29qycifm7j-6{list-style-type:none}ul.lst-kix_fd29qycifm7j-7{list-style-type:none}.lst-kix_phw50b5gkoqx-8>li:before{content:"\0025a0  "}ul.lst-kix_fd29qycifm7j-4{list-style-type:none}ul.lst-kix_fd29qycifm7j-5{list-style-type:none}.lst-kix_psqo3y4bcm35-3>li{counter-increment:lst-ctn-kix_psqo3y4bcm35-3}ul.lst-kix_fd29qycifm7j-8{list-style-type:none}.lst-kix_bqo0s77nhvjl-6>li:before{content:"\0025cf  "}.lst-kix_phw50b5gkoqx-4>li:before{content:"\0025cb  "}ul.lst-kix_fd29qycifm7j-2{list-style-type:none}ul.lst-kix_fd29qycifm7j-3{list-style-type:none}.lst-kix_phw50b5gkoqx-2>li:before{content:"\0025a0  "}.lst-kix_phw50b5gkoqx-6>li:before{content:"\0025cf  "}ul.lst-kix_fd29qycifm7j-0{list-style-type:none}.lst-kix_ng30lxb5ooyf-7>li{counter-increment:lst-ctn-kix_ng30lxb5ooyf-7}ul.lst-kix_fd29qycifm7j-1{list-style-type:none}.lst-kix_bqo0s77nhvjl-4>li:before{content:"\0025cb  "}ol.lst-kix_psqo3y4bcm35-1.start{counter-reset:lst-ctn-kix_psqo3y4bcm35-1 0}.lst-kix_bqo0s77nhvjl-2>li:before{content:"\0025a0  "}.lst-kix_ng30lxb5ooyf-1>li{counter-increment:lst-ctn-kix_ng30lxb5ooyf-1}ol.lst-kix_psqo3y4bcm35-2.start{counter-reset:lst-ctn-kix_psqo3y4bcm35-2 0}.lst-kix_5od327e3dxx8-8>li:before{content:"\0025a0  "}ol.lst-kix_ng30lxb5ooyf-4.start{counter-reset:lst-ctn-kix_ng30lxb5ooyf-4 0}.lst-kix_ntga6soteyfy-8>li:before{content:"\0025a0  "}ul.lst-kix_x44z2zpwa48w-1{list-style-type:none}ul.lst-kix_x44z2zpwa48w-0{list-style-type:none}ul.lst-kix_x44z2zpwa48w-5{list-style-type:none}.lst-kix_stfbtb8a183w-8>li:before{content:"\0025a0  "}ul.lst-kix_x44z2zpwa48w-4{list-style-type:none}ul.lst-kix_x44z2zpwa48w-3{list-style-type:none}ul.lst-kix_stfbtb8a183w-0{list-style-type:none}.lst-kix_stfbtb8a183w-7>li:before{content:"\0025cb  "}ul.lst-kix_x44z2zpwa48w-2{list-style-type:none}.lst-kix_psqo3y4bcm35-0>li{counter-increment:lst-ctn-kix_psqo3y4bcm35-0}ul.lst-kix_stfbtb8a183w-1{list-style-type:none}.lst-kix_153l8idbjbvt-1>li:before{content:"\0025cb  "}ul.lst-kix_x44z2zpwa48w-8{list-style-type:none}.lst-kix_153l8idbjbvt-0>li:before{content:"\0025cf  "}.lst-kix_153l8idbjbvt-2>li:before{content:"\0025a0  "}ul.lst-kix_x44z2zpwa48w-7{list-style-type:none}ul.lst-kix_x44z2zpwa48w-6{list-style-type:none}.lst-kix_5od327e3dxx8-0>li:before{content:"\0025cf  "}ul.lst-kix_psk1dptirxzv-7{list-style-type:none}ul.lst-kix_psk1dptirxzv-8{list-style-type:none}.lst-kix_5od327e3dxx8-1>li:before{content:"\0025cb  "}ul.lst-kix_psk1dptirxzv-5{list-style-type:none}ul.lst-kix_psk1dptirxzv-6{list-style-type:none}.lst-kix_5od327e3dxx8-2>li:before{content:"\0025a0  "}ul.lst-kix_psk1dptirxzv-3{list-style-type:none}.lst-kix_stfbtb8a183w-2>li:before{content:"\0025a0  "}ul.lst-kix_psk1dptirxzv-4{list-style-type:none}ul.lst-kix_psk1dptirxzv-1{list-style-type:none}ul.lst-kix_psk1dptirxzv-2{list-style-type:none}.lst-kix_stfbtb8a183w-4>li:before{content:"\0025cb  "}.lst-kix_ng30lxb5ooyf-4>li{counter-increment:lst-ctn-kix_ng30lxb5ooyf-4}ol.lst-kix_ng30lxb5ooyf-5{list-style-type:none}ul.lst-kix_psk1dptirxzv-0{list-style-type:none}ol.lst-kix_ng30lxb5ooyf-6{list-style-type:none}.lst-kix_5od327e3dxx8-3>li:before{content:"\0025cf  "}.lst-kix_stfbtb8a183w-3>li:before{content:"\0025cf  "}ol.lst-kix_ng30lxb5ooyf-7{list-style-type:none}ol.lst-kix_ng30lxb5ooyf-8{list-style-type:none}.lst-kix_5od327e3dxx8-6>li:before{content:"\0025cf  "}.lst-kix_stfbtb8a183w-6>li:before{content:"\0025cf  "}.lst-kix_5od327e3dxx8-4>li:before{content:"\0025cb  "}.lst-kix_5od327e3dxx8-5>li:before{content:"\0025a0  "}.lst-kix_stfbtb8a183w-5>li:before{content:"\0025a0  "}ol.lst-kix_psqo3y4bcm35-7.start{counter-reset:lst-ctn-kix_psqo3y4bcm35-7 0}.lst-kix_phw50b5gkoqx-0>li:before{content:"\0025cf  "}.lst-kix_phw50b5gkoqx-1>li:before{content:"\0025cb  "}.lst-kix_153l8idbjbvt-8>li:before{content:"\0025a0  "}.lst-kix_stfbtb8a183w-1>li:before{content:"\0025cb  "}.lst-kix_153l8idbjbvt-5>li:before{content:"\0025a0  "}ol.lst-kix_ng30lxb5ooyf-5.start{counter-reset:lst-ctn-kix_ng30lxb5ooyf-5 0}.lst-kix_153l8idbjbvt-4>li:before{content:"\0025cb  "}.lst-kix_153l8idbjbvt-6>li:before{content:"\0025cf  "}.lst-kix_153l8idbjbvt-3>li:before{content:"\0025cf  "}.lst-kix_153l8idbjbvt-7>li:before{content:"\0025cb  "}.lst-kix_stfbtb8a183w-0>li:before{content:"\0025cf  "}ul.lst-kix_stfbtb8a183w-2{list-style-type:none}ul.lst-kix_stfbtb8a183w-3{list-style-type:none}ul.lst-kix_stfbtb8a183w-4{list-style-type:none}ul.lst-kix_stfbtb8a183w-5{list-style-type:none}ul.lst-kix_stfbtb8a183w-6{list-style-type:none}ul.lst-kix_stfbtb8a183w-7{list-style-type:none}ul.lst-kix_stfbtb8a183w-8{list-style-type:none}.lst-kix_psqo3y4bcm35-2>li{counter-increment:lst-ctn-kix_psqo3y4bcm35-2}.lst-kix_1x02cefa4k4l-1>li:before{content:"\0025cb  "}.lst-kix_1x02cefa4k4l-3>li:before{content:"\0025cf  "}.lst-kix_1x02cefa4k4l-0>li:before{content:"\0025cf  "}.lst-kix_1x02cefa4k4l-4>li:before{content:"\0025cb  "}.lst-kix_1x02cefa4k4l-2>li:before{content:"\0025a0  "}.lst-kix_1x02cefa4k4l-7>li:before{content:"\0025cb  "}.lst-kix_1x02cefa4k4l-8>li:before{content:"\0025a0  "}.lst-kix_1x02cefa4k4l-5>li:before{content:"\0025a0  "}.lst-kix_fd29qycifm7j-2>li:before{content:"-  "}.lst-kix_1x02cefa4k4l-6>li:before{content:"\0025cf  "}.lst-kix_psqo3y4bcm35-7>li{counter-increment:lst-ctn-kix_psqo3y4bcm35-7}.lst-kix_fd29qycifm7j-3>li:before{content:"-  "}.lst-kix_fd29qycifm7j-4>li:before{content:"-  "}.lst-kix_psqo3y4bcm35-4>li{counter-increment:lst-ctn-kix_psqo3y4bcm35-4}.lst-kix_fd29qycifm7j-5>li:before{content:"-  "}ol.lst-kix_ng30lxb5ooyf-1{list-style-type:none}ol.lst-kix_ng30lxb5ooyf-2{list-style-type:none}ol.lst-kix_ng30lxb5ooyf-3{list-style-type:none}ol.lst-kix_ng30lxb5ooyf-0.start{counter-reset:lst-ctn-kix_ng30lxb5ooyf-0 0}.lst-kix_ng30lxb5ooyf-2>li{counter-increment:lst-ctn-kix_ng30lxb5ooyf-2}ol.lst-kix_ng30lxb5ooyf-4{list-style-type:none}.lst-kix_fd29qycifm7j-6>li:before{content:"-  "}ol.lst-kix_ng30lxb5ooyf-0{list-style-type:none}ul.lst-kix_1x02cefa4k4l-8{list-style-type:none}.lst-kix_fd29qycifm7j-7>li:before{content:"-  "}ul.lst-kix_1x02cefa4k4l-4{list-style-type:none}ul.lst-kix_1x02cefa4k4l-5{list-style-type:none}.lst-kix_fd29qycifm7j-8>li:before{content:"-  "}ul.lst-kix_1x02cefa4k4l-6{list-style-type:none}ul.lst-kix_1x02cefa4k4l-7{list-style-type:none}ul.lst-kix_1x02cefa4k4l-0{list-style-type:none}ul.lst-kix_1x02cefa4k4l-1{list-style-type:none}ul.lst-kix_1x02cefa4k4l-2{list-style-type:none}ul.lst-kix_1x02cefa4k4l-3{list-style-type:none}ul.lst-kix_phw50b5gkoqx-8{list-style-type:none}ol.lst-kix_psqo3y4bcm35-6.start{counter-reset:lst-ctn-kix_psqo3y4bcm35-6 0}ul.lst-kix_phw50b5gkoqx-7{list-style-type:none}ul.lst-kix_phw50b5gkoqx-6{list-style-type:none}.lst-kix_zef2rxoqwa2v-0>li:before{content:"\0025cf  "}.lst-kix_zef2rxoqwa2v-4>li:before{content:"\0025cb  "}ul.lst-kix_phw50b5gkoqx-5{list-style-type:none}ul.lst-kix_phw50b5gkoqx-4{list-style-type:none}.lst-kix_ng30lxb5ooyf-3>li:before{content:"" counter(lst-ctn-kix_ng30lxb5ooyf-3,decimal) ". "}.lst-kix_ng30lxb5ooyf-7>li:before{content:"" counter(lst-ctn-kix_ng30lxb5ooyf-7,lower-latin) ". "}ul.lst-kix_phw50b5gkoqx-3{list-style-type:none}ul.lst-kix_phw50b5gkoqx-2{list-style-type:none}ul.lst-kix_phw50b5gkoqx-1{list-style-type:none}ul.lst-kix_phw50b5gkoqx-0{list-style-type:none}.lst-kix_zef2rxoqwa2v-6>li:before{content:"\0025cf  "}.lst-kix_psqo3y4bcm35-6>li{counter-increment:lst-ctn-kix_psqo3y4bcm35-6}.lst-kix_ng30lxb5ooyf-5>li:before{content:"" counter(lst-ctn-kix_ng30lxb5ooyf-5,lower-roman) ". "}.lst-kix_psk1dptirxzv-3>li:before{content:"\0025cf  "}ul.lst-kix_bqo0s77nhvjl-4{list-style-type:none}ul.lst-kix_bqo0s77nhvjl-5{list-style-type:none}.lst-kix_x44z2zpwa48w-7>li:before{content:"\0025cb  "}ul.lst-kix_bqo0s77nhvjl-2{list-style-type:none}ul.lst-kix_bqo0s77nhvjl-3{list-style-type:none}.lst-kix_psk1dptirxzv-1>li:before{content:"\0025cb  "}ul.lst-kix_bqo0s77nhvjl-0{list-style-type:none}ul.lst-kix_bqo0s77nhvjl-1{list-style-type:none}.lst-kix_zef2rxoqwa2v-8>li:before{content:"\0025a0  "}.lst-kix_x44z2zpwa48w-5>li:before{content:"\0025a0  "}.lst-kix_ng30lxb5ooyf-1>li:before{content:"" counter(lst-ctn-kix_ng30lxb5ooyf-1,lower-latin) ". "}.lst-kix_fd29qycifm7j-1>li:before{content:"-  "}.lst-kix_x44z2zpwa48w-1>li:before{content:"\0025cb  "}ul.lst-kix_153l8idbjbvt-7{list-style-type:none}ul.lst-kix_153l8idbjbvt-8{list-style-type:none}ul.lst-kix_153l8idbjbvt-3{list-style-type:none}.lst-kix_psqo3y4bcm35-8>li:before{content:"" counter(lst-ctn-kix_psqo3y4bcm35-8,lower-roman) ". "}ul.lst-kix_5od327e3dxx8-0{list-style-type:none}ul.lst-kix_153l8idbjbvt-4{list-style-type:none}ul.lst-kix_153l8idbjbvt-5{list-style-type:none}.lst-kix_x44z2zpwa48w-3>li:before{content:"\0025cf  "}ul.lst-kix_153l8idbjbvt-6{list-style-type:none}ul.lst-kix_bqo0s77nhvjl-8{list-style-type:none}ul.lst-kix_153l8idbjbvt-0{list-style-type:none}ul.lst-kix_153l8idbjbvt-1{list-style-type:none}ul.lst-kix_bqo0s77nhvjl-6{list-style-type:none}ul.lst-kix_153l8idbjbvt-2{list-style-type:none}ul.lst-kix_bqo0s77nhvjl-7{list-style-type:none}ul.lst-kix_5od327e3dxx8-7{list-style-type:none}.lst-kix_psqo3y4bcm35-4>li:before{content:"" counter(lst-ctn-kix_psqo3y4bcm35-4,lower-latin) ". "}ul.lst-kix_5od327e3dxx8-8{list-style-type:none}ul.lst-kix_5od327e3dxx8-5{list-style-type:none}ul.lst-kix_5od327e3dxx8-6{list-style-type:none}.lst-kix_bqo0s77nhvjl-7>li:before{content:"\0025cb  "}ul.lst-kix_5od327e3dxx8-3{list-style-type:none}.lst-kix_psk1dptirxzv-5>li:before{content:"\0025a0  "}ul.lst-kix_5od327e3dxx8-4{list-style-type:none}ul.lst-kix_5od327e3dxx8-1{list-style-type:none}ul.lst-kix_5od327e3dxx8-2{list-style-type:none}.lst-kix_psk1dptirxzv-7>li:before{content:"\0025cb  "}.lst-kix_psqo3y4bcm35-5>li{counter-increment:lst-ctn-kix_psqo3y4bcm35-5}.lst-kix_psqo3y4bcm35-6>li:before{content:"" counter(lst-ctn-kix_psqo3y4bcm35-6,decimal) ". "}.lst-kix_zef2rxoqwa2v-2>li:before{content:"\0025a0  "}.lst-kix_bqo0s77nhvjl-1>li:before{content:"\0025cb  "}ol.lst-kix_psqo3y4bcm35-8.start{counter-reset:lst-ctn-kix_psqo3y4bcm35-8 0}.lst-kix_bqo0s77nhvjl-5>li:before{content:"\0025a0  "}.lst-kix_phw50b5gkoqx-7>li:before{content:"\0025cb  "}.lst-kix_phw50b5gkoqx-5>li:before{content:"\0025a0  "}.lst-kix_bqo0s77nhvjl-3>li:before{content:"\0025cf  "}.lst-kix_phw50b5gkoqx-3>li:before{content:"\0025cf  "}.lst-kix_5od327e3dxx8-7>li:before{content:"\0025cb  "}ul.lst-kix_zef2rxoqwa2v-1{list-style-type:none}ul.lst-kix_zef2rxoqwa2v-0{list-style-type:none}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}ul.lst-kix_zef2rxoqwa2v-3{list-style-type:none}ul.lst-kix_zef2rxoqwa2v-2{list-style-type:none}ul.lst-kix_zef2rxoqwa2v-5{list-style-type:none}ul.lst-kix_zef2rxoqwa2v-4{list-style-type:none}ul.lst-kix_zef2rxoqwa2v-7{list-style-type:none}ul.lst-kix_zef2rxoqwa2v-6{list-style-type:none}ul.lst-kix_zef2rxoqwa2v-8{list-style-type:none}.lst-kix_ntga6soteyfy-7>li:before{content:"\0025cb  "}ol{margin:0;padding:0}table td,table th{padding:0}.c28{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:111.8pt;border-top-color:#000000;border-bottom-style:solid}.c13{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:356.2pt;border-top-color:#000000;border-bottom-style:solid}.c34{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:522pt;border-top-color:#000000;border-bottom-style:solid}.c10{-webkit-text-decoration-skip:none;color:#1155cc;font-weight:400;text-decoration:underline;vertical-align:baseline;text-decoration-skip-ink:none;font-size:11pt;font-family:"Arial";font-style:normal}.c31{background-color:#f6f8fa;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-family:"Courier New";font-style:normal}.c0{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c11{padding-top:18pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c5{margin-left:18pt;padding-top:3pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c6{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:9pt;font-family:"Arial";font-style:normal}.c37{margin-left:18pt;padding-top:3pt;padding-bottom:4pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c40{color:#434343;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:14pt;font-family:"Arial";font-style:normal}.c18{margin-left:36pt;padding-top:3pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c22{padding-top:20pt;padding-bottom:6pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c36{padding-top:18pt;padding-bottom:10pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c12{color:#000000;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c33{padding-top:4pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c19{padding-top:0pt;padding-bottom:10pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c14{padding-top:10pt;padding-bottom:10pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c35{padding-top:0pt;padding-bottom:10pt;line-height:1.4;orphans:2;widows:2;text-align:left}.c38{padding-top:16pt;padding-bottom:4pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c23{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-family:"Arial";font-style:normal}.c39{padding-top:16pt;padding-bottom:10pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c7{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c26{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline}.c4{padding-top:0pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c15{border-spacing:0;border-collapse:collapse;margin-right:auto}.c30{background-color:#ffffff;max-width:522pt;padding:72pt 45pt 72pt 45pt}.c17{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;text-decoration:line-through}.c41{background-color:#f6f8fa;font-family:"Courier New";font-weight:400}.c16{padding:0;margin:0}.c1{color:inherit;text-decoration:inherit}.c8{margin-left:36pt;padding-left:0pt}.c9{height:11pt}.c29{font-size:9pt}.c27{height:24.5pt}.c20{page-break-after:avoid}.c2{font-weight:700}.c25{color:#ff0000}.c3{height:0pt}.c21{font-size:8pt}.c32{font-size:20pt}.c24{font-size:16pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c30 doc-content"><p class="c7 c9"><span class="c0"></span></p><p class="c33"><span class="c10"><a class="c1" href="#h.sfby9fpbe5t0">Kafka</a></span></p><p class="c5"><span class="c10"><a class="c1" href="#h.xn1f86gn5ar8">Zookeeper</a></span></p><p class="c5"><span class="c10"><a class="c1" href="#h.qzhguukupa73">Kafka Cluster</a></span></p><p class="c5"><span class="c10"><a class="c1" href="#h.pw5irdk6pfwy">Topics and partitions</a></span></p><p class="c18"><span class="c10"><a class="c1" href="#h.z4hji7vfpz7g">Topic VS Queue</a></span></p><p class="c5"><span class="c10"><a class="c1" href="#h.3rs5ase7gwzo">Replication</a></span></p><p class="c18"><span class="c10"><a class="c1" href="#h.7rsp474035c">Leader-Follower</a></span></p><p class="c5"><span class="c10"><a class="c1" href="#h.sv43koj27z3b">Data loss</a></span></p><p class="c5"><span class="c10"><a class="c1" href="#h.1too947u0zit">Delivery semantics</a></span></p><p class="c5"><span class="c10"><a class="c1" href="#h.ozznxx9bwj1x">Performance</a></span></p><p class="c5"><span class="c10"><a class="c1" href="#h.8vz7jaafmg89">Starting kafka</a></span></p><p class="c18"><span class="c10"><a class="c1" href="#h.56qxjis0cyb5">Kafka Listeners explained</a></span></p><p class="c5"><span class="c10"><a class="c1" href="#h.cb9tpo7n5eoz">Configuration example</a></span></p><p class="c5"><span class="c10"><a class="c1" href="#h.92qfmu1ddz2">Read&amp;Write examples</a></span></p><p class="c5"><span class="c10"><a class="c1" href="#h.cdop8vo5tlw9">Useful commands</a></span></p><p class="c5"><span class="c10"><a class="c1" href="#h.8y9b0rw5zlkv">Large messages</a></span></p><p class="c37"><span class="c10"><a class="c1" href="#h.p5z9bnmk3cj">li-apache-kafka-clients</a></span></p><p class="c7 c9"><span class="c0"></span></p><p class="c7 c9"><span class="c0"></span></p><h1 class="c20 c22" id="h.sfby9fpbe5t0"><span class="c23 c32">Kafka</span></h1><p class="c19"><span class="c26"><a class="c1" href="https://www.google.com/url?q=https://www.youtube.com/watch?v%3D-AZOi3kP9Js&amp;sa=D&amp;source=editors&amp;ust=1657548662447414&amp;usg=AOvVaw1yDBJ_VRksQ6nMZyyKkVPs">https://www.youtube.com/watch?v=-AZOi3kP9Js</a></span><span class="c0">&nbsp;</span></p><p class="c19"><span class="c26"><a class="c1" href="https://www.google.com/url?q=https://www.youtube.com/watch?v%3DBtmYjTO1EpI&amp;sa=D&amp;source=editors&amp;ust=1657548662447862&amp;usg=AOvVaw2jFLFPW5zTpIexx0UQUlAf">https://www.youtube.com/watch?v=BtmYjTO1EpI</a></span><span class="c0">&nbsp;</span></p><p class="c19"><span>Kafka is an open-source </span><span class="c2">message broker</span><span>&nbsp;project developed by the Apache Software Foundation written in Scala and is a distributed </span><span class="c2">publish-subscribe messaging system</span><span>. Kafka&rsquo;s design pattern is mainly based on the </span><span class="c2">transactional logs</span><span class="c0">&nbsp;design.</span></p><p class="c19"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 696.00px; height: 258.67px;"><img alt="" src="images/image12.png" style="width: 696.00px; height: 258.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c14"><span class="c0">What can you do with Kafka?</span></p><ul class="c16 lst-kix_ntga6soteyfy-0 start"><li class="c14 c8 li-bullet-0"><span class="c0">In order to transmit data between two systems, we can build a real-time stream of data pipelines with it.</span></li><li class="c14 c8 li-bullet-0"><span class="c0">Also, we can build a real-time streaming platform with Kafka, that can actually react to the data.</span></li></ul><a id="t.0faa489ad5dc4189deeb0f39875916bcf8f04fa1"></a><a id="t.0"></a><table class="c15"><tr class="c3"><td class="c28" colspan="1" rowspan="1"><p class="c19"><span class="c2 c12">Feature</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c19"><span class="c12 c2">Description</span></p></td></tr><tr class="c27"><td class="c28" colspan="1" rowspan="1"><p class="c7"><span class="c0">High Throughput</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c7"><span class="c0">Support for millions of messages with modest hardware</span></p></td></tr><tr class="c3"><td class="c28" colspan="1" rowspan="1"><p class="c7"><span class="c0">Scalability</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c7"><span class="c0">Highly scalable distributed systems with no downtime</span></p></td></tr><tr class="c3"><td class="c28" colspan="1" rowspan="1"><p class="c7"><span class="c0">Replication</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c7"><span class="c0">Messages are replicated across the cluster to provide support for multiple subscribers and balances the consumers in case of failures</span></p></td></tr><tr class="c3"><td class="c28" colspan="1" rowspan="1"><p class="c7"><span class="c0">Durability</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c7"><span class="c0">Provides support for persistence of message to disk</span></p></td></tr><tr class="c3"><td class="c28" colspan="1" rowspan="1"><p class="c7"><span class="c0">Stream Processing</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c7"><span class="c0">Used with real-time streaming applications like Apache Spark &amp; Storm</span></p></td></tr><tr class="c3"><td class="c28" colspan="1" rowspan="1"><p class="c7"><span class="c0">Data Loss</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c7"><span class="c0">Kafka with proper configurations can ensure zero data loss</span></p></td></tr></table><p class="c14"><span class="c0">List the various components in Kafka:</span></p><ul class="c16 lst-kix_phw50b5gkoqx-0 start"><li class="c14 c8 li-bullet-0"><span class="c0">Topic &ndash; a stream of messages belonging to the same type</span></li><li class="c14 c8 li-bullet-0"><span class="c0">Producer &ndash; that can publish messages to a topic</span></li><li class="c14 c8 li-bullet-0"><span class="c0">Brokers &ndash; a set of servers where the publishes messages are stored</span></li><li class="c14 c8 li-bullet-0"><span class="c0">Consumer &ndash; that subscribes to various topics and pulls data from the brokers.</span></li></ul><h2 class="c11" id="h.xn1f86gn5ar8"><span class="c23 c24">Zookeeper</span></h2><p class="c14"><span>Kafka uses </span><span class="c2">Zookeeper</span><span class="c0">&nbsp;to store offsets of messages consumed for a specific topic and partition by a specific Consumer Group. (Message offset role: messages contained in the partitions are assigned a unique ID number that is called the offset. The role of the offset is to uniquely identify every message within the partition) </span></p><p class="c14"><span class="c0">It is not possible to bypass Zookeeper and connect directly to the Kafka server. If, for some reason, ZooKeeper is down, you cannot service any client request.</span></p><p class="c14"><span class="c0">Apache ZooKeeper is an open-source server for highly reliable distributed coordination of cloud applications. It is a project of the Apache Software Foundation.</span></p><p class="c14"><span>ZooKeeper is essentially a service for distributed systems offering a hierarchical </span><span class="c2">key-value store</span><span class="c0">, which is used to provide a distributed configuration service, synchronization service, and naming registry for large distributed systems. ZooKeeper was a sub-project of Hadoop but is now a top-level Apache project in its own right.</span></p><p class="c14"><span class="c0">Typical use cases for ZooKeeper are:</span></p><ul class="c16 lst-kix_bqo0s77nhvjl-0 start"><li class="c14 c8 li-bullet-0"><span class="c0">Naming service</span></li><li class="c14 c8 li-bullet-0"><span class="c0">Configuration management</span></li><li class="c14 c8 li-bullet-0"><span class="c0">Data Synchronization</span></li><li class="c14 c8 li-bullet-0"><span class="c0">Leader election</span></li><li class="c14 c8 li-bullet-0"><span class="c0">Message queue</span></li><li class="c14 c8 li-bullet-0"><span class="c0">Notification system</span></li></ul><p class="c14"><span class="c0">Kafka message contains:</span></p><ul class="c16 lst-kix_x44z2zpwa48w-0 start"><li class="c14 c8 li-bullet-0"><span class="c0">key (optional) - used for message distribution across partitions</span></li><li class="c14 c8 li-bullet-0"><span class="c0">value - byte array</span></li><li class="c14 c8 li-bullet-0"><span class="c0">timestamp - set either before sending by clien or after receiving by broker</span></li><li class="c14 c8 li-bullet-0"><span class="c0">headers - key-value pairs/attributes</span></li></ul><h2 class="c14 c20" id="h.qzhguukupa73"><span class="c23 c24">Kafka Cluster</span></h2><p class="c14"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 345.50px; height: 287.42px;"><img alt="" src="images/image21.png" style="width: 345.50px; height: 287.42px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c14"><span class="c0">We may want to process messages with multiple consumers. We can organize concurrent processing of a topic using multiple partitions, and each partition is attached to its consumers using a group mechanism, as shown below. </span></p><ul class="c16 lst-kix_fd29qycifm7j-0 start"><li class="c14 c8 li-bullet-0"><span>Single consumer can process more than 1 partition in a topic when </span><span class="c2">NoPartitions &gt; NoConsumers</span><span class="c0">. </span></li><li class="c14 c8 li-bullet-0"><span>Some consumers stay idle (have no job to do) when </span><span class="c12 c2">NoPartitions &lt; NoConsumers</span></li></ul><p class="c14"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 458.50px; height: 252.97px;"><img alt="" src="images/image16.png" style="width: 458.50px; height: 252.97px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c14"><span class="c0">In order to overcome the challenges of collecting the large volume of data, and analyzing the collected data we need a messaging system. Hence Apache Kafka came into the story. Its benefits are:</span></p><ul class="c16 lst-kix_zef2rxoqwa2v-0 start"><li class="c14 c8 li-bullet-0"><span class="c0">It is possible to track web activities just by storing/sending the events for real-time processes.</span></li><li class="c14 c8 li-bullet-0"><span class="c0">Through this, we can Alert as well as report the operational metrics.</span></li><li class="c14 c8 li-bullet-0"><span class="c0">Also, we can transform data into the standard format.</span></li><li class="c14 c8 li-bullet-0"><span class="c0">Moreover, it allows continuous processing of streaming data to the topics.</span></li></ul><h2 class="c14 c20" id="h.pw5irdk6pfwy"><span class="c23 c24">Topics and partitions</span></h2><p class="c14"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 380.50px; height: 179.45px;"><img alt="" src="images/image1.png" style="width: 380.50px; height: 179.45px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c14"><span class="c0">Choosing partition to send the message to:</span></p><p class="c14"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 472.50px; height: 282.58px;"><img alt="" src="images/image23.png" style="width: 472.50px; height: 282.58px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c14"><span class="c0">Sending batch to broker:</span></p><p class="c14"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 414.50px; height: 246.53px;"><img alt="" src="images/image8.png" style="width: 414.50px; height: 246.53px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c14"><span>The optimal number of partitions (for maximum throughput) per cluster is around the number of CPU cores (or slightly more, up to 100 partitions), i.e.cluster </span><span class="c12 c2">CPU cores &gt;= optimal partitions &lt;= 100</span></p><p class="c14"><span class="c2">Too many partitions result in a significant drop in throughput</span><span class="c0">&nbsp;(however, you can get increased throughput for more partitions by increasing the size of your cluster).</span></p><p class="c14"><span>Setting producer </span><span class="c2">acks=all can give comparable or even slightly better throughput</span><span class="c0">&nbsp;compared with the default of acks=1.</span></p><p class="c14"><span>Setting producer </span><span class="c2">acks=all results in higher latencies</span><span class="c0">&nbsp;compared with the default of acks=1.</span></p><p class="c14"><span>Both producer acks=all and idempotence=true have comparable durability, throughput, and latency (i.e. the only practical difference is that </span><span class="c2">idempotence=true guarantees exactly-once semantics for producers</span><span class="c0">).</span></p><h3 class="c14 c20" id="h.z4hji7vfpz7g"><span class="c40">Topic VS Queue</span></h3><p class="c14"><span class="c0">Is Kafka a Topic or a Queue?</span></p><p class="c14"><span class="c26"><a class="c1" href="https://www.google.com/url?q=https://abhishek1987.medium.com/kafka-is-it-a-topic-or-a-queue-30c85386afd6&amp;sa=D&amp;source=editors&amp;ust=1657548662457427&amp;usg=AOvVaw1uhc8Z_-KxuIIid5mMye39">https://abhishek1987.medium.com/kafka-is-it-a-topic-or-a-queue-30c85386afd6</a></span><span class="c0">&nbsp;</span></p><p class="c14"><span>Kafka is both a Topic and a Queue. Queue based systems are typically designed in a way that there are multiple consumers processing data from a queue and the work gets distributed such that </span><span class="c2">each consumer gets a different set of items to process</span><span class="c0">. Hence there is no overlap, allowing the workload to be shared and enables horizontally scalable architectures.</span></p><p class="c14"><span>A Kafka topic is sub-divided into units called partitions for fault tolerance and scalability. </span><span class="c2">Consumer Groups allow Kafka to behave like a Queue</span><span class="c0">, since each consumer instance in a group processes data from a non-overlapping set of partitions (within a Kafka topic).</span></p><h2 class="c14 c20" id="h.3rs5ase7gwzo"><span class="c23 c24">Replication</span></h2><p class="c19"><span>Replicas are essentially a list of nodes that </span><span class="c2">replicate the log for a particular partition</span><span class="c0">&nbsp;irrespective of whether they play the role of the Leader. On the other hand, ISR stands for In-Sync Replicas. It is essentially a set of message replicas that are synced to the leaders.</span></p><p class="c19"><span class="c0">Replication ensures that published messages are not lost and can be consumed in the event of any machine error, program error or frequent software upgrades.</span></p><p class="c14"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 358.50px; height: 146.69px;"><img alt="" src="images/image19.png" style="width: 358.50px; height: 146.69px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c14"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 357.30px; height: 146.08px;"><img alt="" src="images/image24.png" style="width: 357.30px; height: 146.08px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c7"><span class="c0">Problem of imbalance partition placement be like:</span></p><p class="c14"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 432.50px; height: 181.60px;"><img alt="" src="images/image14.png" style="width: 432.50px; height: 181.60px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c14"><span class="c0">Data is stored in log files:</span></p><p class="c14"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 522.64px; height: 270.50px;"><img alt="" src="images/image7.png" style="width: 522.64px; height: 270.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 220.01px; height: 200.08px;"><img alt="" src="images/image9.png" style="width: 220.01px; height: 200.08px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c14"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 253.13px; height: 206.50px;"><img alt="" src="images/image18.png" style="width: 253.13px; height: 206.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c14"><span class="c0">Every .log file size is limited:</span></p><p class="c14"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 490.50px; height: 255.82px;"><img alt="" src="images/image11.png" style="width: 490.50px; height: 255.82px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><h3 class="c20 c39" id="h.7rsp474035c"><span class="c40">Leader-Follower</span></h3><p class="c19"><span>Every partition in Kafka has one server which plays the role of a Leader, and none or more servers that act as Followers. </span><span class="c2">The Leader performs the task of all read and write requests</span><span class="c0">&nbsp;for the partition, while the role of the Followers is to passively replicate the leader. In the event of the Leader failing, one of the Followers will take on the role of the Leader. This ensures load balancing of the server.</span></p><p class="c19"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 445.50px; height: 201.35px;"><img alt="" src="images/image5.png" style="width: 445.50px; height: 201.35px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c19"><span class="c0">Imbalance leader election problem (Broker #1 is under heavy load)</span></p><p class="c19"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 450.50px; height: 181.24px;"><img alt="" src="images/image6.png" style="width: 450.50px; height: 181.24px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><h2 class="c36 c20" id="h.sv43koj27z3b"><span class="c23 c24">Data loss</span></h2><p class="c7"><span class="c0">A data loss can happen during leader reelection even if you have replication factor &gt; 1, because generally speaking replicas are out-of-sync with the leader. In order to solve this problem, kafka supports In-Sync-Replicas (ISR).</span></p><p class="c7"><span class="c0">Leader makes sure all the ISR replicas are in-sync before sending &lsquo;ack&rsquo;-response to the producer. ISRs are good candidates for a leader reelection. </span></p><p class="c19"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 696.00px; height: 177.33px;"><img alt="" src="images/image15.png" style="width: 696.00px; height: 177.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><h2 class="c20 c36" id="h.1too947u0zit"><span class="c23 c24">Delivery semantics</span></h2><p class="c7"><span class="c0">ack = 0 - no confirmation from broker required</span></p><p class="c7"><span class="c0">ack = 1 - leader has processed the message</span></p><p class="c7"><span class="c0">ack = -1 (all) - leader and all ISR have processed the message</span></p><p class="c7"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 654.50px; height: 398.72px;"><img alt="" src="images/image10.png" style="width: 654.50px; height: 398.72px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c7 c9"><span class="c0"></span></p><p class="c7"><span class="c0">What guarantees of delivery/message processing do we have?</span></p><p class="c7 c9"><span class="c0"></span></p><p class="c7"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 411.50px; height: 229.40px;"><img alt="" src="images/image20.png" style="width: 411.50px; height: 229.40px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c7 c9"><span class="c0"></span></p><p class="c7"><span class="c2">At most once</span><span class="c0">&nbsp;scenario (auto commit):</span></p><p class="c7"><span>Consumer pulls message -&gt; auto commit happens (update an offset for a group in __consumer_offset topic) -&gt; </span><span class="c25">consumer fails</span><span>&nbsp;-&gt; </span><span class="c17">consumer handles the message</span><span class="c0">. </span></p><p class="c7"><span>The offset is updated but the message has not been processed. </span><span class="c2">The message is lost</span><span class="c0">.</span></p><p class="c7 c9"><span class="c0"></span></p><p class="c7"><span class="c2">At least once</span><span class="c0">&nbsp;scenario (manual commit):</span></p><p class="c7"><span>Consumer pulls message -&gt; consumer handles the message -&gt; </span><span class="c25">consumer fails</span><span>&nbsp;-&gt; </span><span class="c17">consumer manually commits</span><span class="c0">. </span></p><p class="c7"><span>After the consumer restarts the same message would be pulled and processed all over again. </span><span class="c2">Duplicate processing</span><span class="c0">.</span></p><p class="c7 c9"><span class="c0"></span></p><p class="c7"><span class="c2">Exactly once</span><span class="c0">&nbsp;scenario:</span></p><p class="c7"><span class="c0">Implement a mechanism of storing offset in an external storage, do not rely on __consumer_offset data.</span></p><p class="c7"><span class="c0">Example: </span></p><p class="c7"><span class="c0">Event X = money transfer from User A to User B. We want to handle this event exactly once, obviously. Suppose we use RDBMS that supports transactions. In that DB, we store info about user accounts as well as the kafka offset value for the most recent operation processed. After reading Event X, we perform a money transfer and update the offset value within a single transaction. </span></p><h2 class="c11" id="h.ozznxx9bwj1x"><span class="c23 c24">Performance</span></h2><p class="c7"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 534.50px; height: 287.98px;"><img alt="" src="images/image4.png" style="width: 534.50px; height: 287.98px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c7"><span class="c0">Explanation about sequential write/read and zero-copy mechanism:</span></p><p class="c7"><span class="c26"><a class="c1" href="https://www.google.com/url?q=https://www.youtube.com/watch?v%3DUNUz1-msbOM%26ab_channel%3DByteByteGo&amp;sa=D&amp;source=editors&amp;ust=1657548662461840&amp;usg=AOvVaw3BrSFm-TfteoLUoA5gj9zN">https://www.youtube.com/watch?v=UNUz1-msbOM&amp;ab_channel=ByteByteGo</a></span><span class="c0">&nbsp;</span></p><h2 class="c11" id="h.8vz7jaafmg89"><span class="c23 c24">Starting kafka</span></h2><p class="c7"><span class="c0">Typical docker-compose.yml running zookeeper + kafka:</span></p><a id="t.3065f8797dc83e15129078d8644b012abb30770b"></a><a id="t.1"></a><table class="c15"><tr class="c3"><td class="c34" colspan="1" rowspan="1"><p class="c4"><span class="c0">version: &#39;2&#39;</span></p><p class="c4"><span class="c0">services:</span></p><p class="c4"><span class="c0">&nbsp; zookeeper:</span></p><p class="c4"><span class="c0">&nbsp; &nbsp; container_name: zookeeper</span></p><p class="c4"><span class="c0">&nbsp; &nbsp; networks: </span></p><p class="c4"><span class="c0">&nbsp; &nbsp; &nbsp; - kafka_network</span></p><p class="c4"><span class="c0">&nbsp; &nbsp; ...</span></p><p class="c4"><span class="c0">&nbsp; </span></p><p class="c4"><span class="c0">&nbsp; kafka:</span></p><p class="c4"><span class="c0">&nbsp; &nbsp; container_name: kafka</span></p><p class="c4"><span class="c0">&nbsp; &nbsp; networks: </span></p><p class="c4"><span class="c0">&nbsp; &nbsp; &nbsp; - kafka_network</span></p><p class="c4"><span class="c0">&nbsp; &nbsp; ports:</span></p><p class="c4"><span class="c0">&nbsp; &nbsp; &nbsp; - 29092:29092</span></p><p class="c4"><span class="c0">&nbsp; &nbsp; environment:</span></p><p class="c4"><span class="c0">&nbsp; &nbsp; &nbsp; KAFKA_LISTENERS: EXTERNAL_SAME_HOST://:29092,INTERNAL://:9092</span></p><p class="c4"><span class="c0">&nbsp; &nbsp; &nbsp; KAFKA_ADVERTISED_LISTENERS: INTERNAL://kafka:9092,EXTERNAL_SAME_HOST://localhost:29092</span></p><p class="c4"><span class="c0">&nbsp; &nbsp; &nbsp; KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: INTERNAL:PLAINTEXT,EXTERNAL_SAME_HOST:PLAINTEXT</span></p><p class="c4"><span class="c0">&nbsp; &nbsp; &nbsp; KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL</span></p><p class="c4"><span class="c0">&nbsp; &nbsp; &nbsp;... </span></p><p class="c4 c9"><span class="c0"></span></p><p class="c4"><span class="c0">networks:</span></p><p class="c4"><span class="c0">&nbsp; kafka_network:</span></p><p class="c4"><span class="c0">&nbsp; &nbsp; name: kafka_docker_example_net</span></p><p class="c4 c9"><span class="c0"></span></p></td></tr></table><h3 class="c20 c38" id="h.56qxjis0cyb5"><span class="c40">Kafka Listeners explained</span></h3><p class="c19"><span class="c26"><a class="c1" href="https://www.google.com/url?q=https://rmoff.net/2018/08/02/kafka-listeners-explained/&amp;sa=D&amp;source=editors&amp;ust=1657548662465898&amp;usg=AOvVaw09Ptp5YS3TSQjp3ihqkn76">https://rmoff.net/2018/08/02/kafka-listeners-explained/</a></span><span class="c0">&nbsp;</span></p><p class="c19"><span class="c0">and even better article:</span></p><p class="c19"><span class="c26"><a class="c1" href="https://www.google.com/url?q=https://www.confluent.io/blog/kafka-client-cannot-connect-to-broker-on-aws-on-docker-etc/&amp;sa=D&amp;source=editors&amp;ust=1657548662466336&amp;usg=AOvVaw2GlPSraCigucPXbc-QMwLR">https://www.confluent.io/blog/kafka-client-cannot-connect-to-broker-on-aws-on-docker-etc/</a></span><span class="c0">&nbsp;</span></p><p class="c19"><span class="c0">Example config:</span></p><p class="c19"><span class="c31 c29">KAFKA_LISTENERS: LISTENER_BOB://kafka0:29092,LISTENER_FRED://localhost:9092</span></p><p class="c19"><span class="c29 c31">KAFKA_ADVERTISED_LISTENERS: LISTENER_BOB://kafka0:29092,LISTENER_FRED://localhost:9092</span></p><p class="c19"><span class="c31 c29">KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: LISTENER_BOB:PLAINTEXT,LISTENER_FRED:PLAINTEXT</span></p><p class="c35"><span class="c29 c41">KAFKA_INTER_BROKER_LISTENER_NAME: LISTENER_BOB</span></p><p class="c19"><span class="c0">tl;dr : You need to set advertised.listeners (or KAFKA_ADVERTISED_LISTENERS if you&rsquo;re using Docker images) to the external address (host/IP) so that clients can correctly connect to it. Otherwise they&rsquo;ll try to connect to the internal host address&ndash;and if that&rsquo;s not reachable then problems ensue.</span></p><p class="c7"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 563.50px; height: 274.46px;"><img alt="" src="images/image22.png" style="width: 563.50px; height: 274.46px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c7"><span class="c0">You need to tell Kafka how the brokers can reach each other, but also make sure that external clients (producers/consumers) can reach the broker they need to.</span></p><p class="c7 c9"><span class="c0"></span></p><p class="c7"><span>The key thing is that when you run a client, the broker you pass to it is just where it&rsquo;s going to go and get the metadata about brokers in the cluster from. The actual host &amp; IP that it will connect to for reading/writing data is based on </span><span class="c2">the data that the broker passes back in that initial connection</span><span class="c0">&mdash;even if it&rsquo;s just a single node and the broker returned is the same as the one connected to.</span></p><p class="c7 c9"><span class="c0"></span></p><ul class="c16 lst-kix_stfbtb8a183w-0 start"><li class="c7 c8 li-bullet-0"><span class="c0">KAFKA_LISTENERS is a comma-separated list of listeners, and the host/ip and port to which Kafka binds to on which to listen. For more complex networking this might be an IP address associated with a given network interface on a machine. The default is 0.0.0.0, which means listening on all interfaces. (listeners)</span></li></ul><ul class="c16 lst-kix_1x02cefa4k4l-0 start"><li class="c7 c8 li-bullet-0"><span class="c0">KAFKA_ADVERTISED_LISTENERS is a comma-separated list of listeners with their host/ip and port. This is the metadata that&rsquo;s passed back to clients. (advertised.listeners)</span></li></ul><ul class="c16 lst-kix_psk1dptirxzv-0 start"><li class="c7 c8 li-bullet-0"><span class="c0">KAFKA_LISTENER_SECURITY_PROTOCOL_MAP defines key/value pairs for the security protocol to use, per listener name. (listener.security.protocol.map)</span></li><li class="c7 c8 li-bullet-0"><span class="c0">KAFKA_INTER_BROKER_LISTENER_NAME: Kafka brokers communicate between themselves, usually on the internal network (e.g. Docker network, AWS VPC, etc). To define which listener to use, specify KAFKA_INTER_BROKER_LISTENER_NAME (inter.broker.listener.name). The host/IP used must be accessible from the broker machine to others.</span></li></ul><h2 class="c11" id="h.cb9tpo7n5eoz"><span class="c23 c24">Configuration example </span></h2><p class="c7"><span>Configuration for Spring is given below, property names are similar to kafka properties (for example, </span><span class="c2">spring.kafka.consumer.auto-offset-reset</span><span>&nbsp;is derived from </span><span class="c2">auto.offset.reset</span><span class="c0">&nbsp;property for kafka consumer etc)</span></p><a id="t.fd3f9cdaa419b57faae8347cfa2b6e4848b16b49"></a><a id="t.2"></a><table class="c15"><tr class="c3"><td class="c34" colspan="1" rowspan="1"><p class="c4"><span class="c6">spring:</span></p><p class="c4"><span class="c6">&nbsp; kafka:</span></p><p class="c4"><span class="c6">&nbsp; &nbsp; bootstrap-servers: localhost:9092</span></p><p class="c4"><span class="c6">&nbsp; &nbsp; listener:</span></p><p class="c4"><span class="c6">&nbsp; &nbsp; &nbsp; client-id: &ldquo;my-consumer&quot;</span></p><p class="c4"><span class="c6">&nbsp; &nbsp; &nbsp; type: single</span></p><p class="c4"><span class="c6">&nbsp; &nbsp; &nbsp; ack-mode: record</span></p><p class="c4"><span class="c6">&nbsp; &nbsp; &nbsp; concurrency: 5</span></p><p class="c4"><span class="c6">&nbsp; &nbsp; consumer:</span></p><p class="c4"><span class="c6">&nbsp; &nbsp; &nbsp; key-deserializer: org.apache.kafka.common.serialization.StringDeserializer</span></p><p class="c4"><span class="c6">&nbsp; &nbsp; &nbsp; value-deserializer: org.apache.kafka.common.serialization.ByteArrayDeserializer</span></p><p class="c4"><span class="c6">&nbsp; &nbsp; &nbsp; auto-offset-reset: earliest</span></p><p class="c4"><span class="c6">&nbsp; &nbsp; &nbsp; group-id: &quot;group-1&quot;</span></p><p class="c4"><span class="c6">&nbsp; &nbsp; &nbsp; enable-auto-commit: false</span></p><p class="c4"><span class="c6">&nbsp; &nbsp; producer:</span></p><p class="c4"><span class="c6">&nbsp; &nbsp; &nbsp; acks: 1</span></p><p class="c4"><span class="c6">&nbsp; &nbsp; &nbsp; key-serializer: org.apache.kafka.common.serialization.StringSerializer</span></p><p class="c4"><span class="c6">&nbsp; &nbsp; &nbsp; value-serializer: org.apache.kafka.common.serialization.ByteArraySerializer</span></p><p class="c4"><span class="c6">&nbsp; &nbsp; &nbsp; &#8203;&#8203;compression-type: gzip</span></p></td></tr></table><p class="c7 c9"><span class="c0"></span></p><p class="c7"><span class="c0">Producer batch configs:</span></p><p class="c7"><span class="c2">linger.ms</span><span class="c0">&nbsp;(default is 0)</span></p><p class="c7"><span class="c2">batch.size</span><span class="c0">&nbsp;(default is 16384 bytes)</span></p><p class="c7 c9"><span class="c0"></span></p><p class="c7"><span class="c0">After the Kafka producer collects a batch.size worth of messages it will send that batch. But, Kafka waits for linger.ms amount of milliseconds. Since linger.ms is 0 by default, Kafka won&rsquo;t batch messages and send each message immediately.</span></p><h2 class="c11" id="h.92qfmu1ddz2"><span class="c23 c24">Read&amp;Write examples</span></h2><p class="c7"><span>Read from broker using Spring </span><span class="c2">Listener</span><span class="c0">:</span></p><a id="t.96bed6569f3e7bf06360b041ed06902f50caf884"></a><a id="t.3"></a><table class="c15"><tr class="c3"><td class="c34" colspan="1" rowspan="1"><p class="c4"><span class="c0">@KafkaListener(topics = &quot;#{&#39;${broker.myTopicName}&#39;}&quot;)</span></p><p class="c4"><span class="c0">&nbsp; &nbsp; public void handleMessage(ConsumerRecord&lt;String, byte[]&gt; record) {</span></p><p class="c4"><span class="c0">&hellip;</span></p><p class="c4"><span class="c0">}</span></p></td></tr></table><p class="c7"><span>Read from broker directly using kafka-clients </span><span class="c2">Consumer</span><span class="c0">:</span></p><a id="t.d0f2de07ef7a5e6181e4e677df4eab765838a8cd"></a><a id="t.4"></a><table class="c15"><tr class="c3"><td class="c34" colspan="1" rowspan="1"><p class="c4"><span class="c0">var consumer = new KafkaConsumer&lt;&gt;(properties);</span></p><p class="c4"><span class="c0">consumer.subscribe(Set.of(brokerProperties.getMyTopicName()));</span></p><p class="c4"><span class="c0">var records = consumer</span></p><p class="c4"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .poll(Duration.ofMillis(5000))</span></p><p class="c4"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .records(brokerProperties.getMyTopicName()).iterator();</span></p></td></tr></table><p class="c7 c9"><span class="c0"></span></p><p class="c7"><span>Write to broker using Spring </span><span class="c2">KafkaTemplate</span><span class="c0">:</span></p><a id="t.e39f013446742ebff1ecf35bdca630d0359bf599"></a><a id="t.5"></a><table class="c15"><tr class="c3"><td class="c34" colspan="1" rowspan="1"><p class="c4"><span class="c0">private final KafkaTemplate&lt;String, String&gt; kafkaTemplate;</span></p><p class="c4"><span class="c0">&hellip;</span></p><p class="c4"><span class="c0">var producerRecord = new ProducerRecord&lt;&gt;(&quot;topic-name&rdquo;, key, value);</span></p><p class="c4"><span class="c0">kafkaTemplate.send(producerRecord).get();</span></p></td></tr></table><p class="c7"><span>Write to broker directly using kafka-clients </span><span class="c2">Producer</span><span class="c0">:</span></p><a id="t.6c8d4dabad440d1f421739e3afd803408287a5cb"></a><a id="t.6"></a><table class="c15"><tr class="c3"><td class="c34" colspan="1" rowspan="1"><p class="c4"><span class="c0">var producer = new KafkaProducer&lt;&gt;(properties);</span></p><p class="c4"><span class="c0">var producerRecord = new ProducerRecord&lt;&gt;(&quot;topic-name&rdquo;, key, value);</span></p><p class="c4"><span class="c0">producer.send(producerRecord).get();</span></p></td></tr></table><p class="c7 c9"><span class="c0"></span></p><p class="c7"><span class="c0">Compression type should be set for both broker (or at a topic level) and producer. It is generally advised to set compression-type:producer on the broker side (for a topic) so the broker uses compression type set by producer.</span></p><a id="t.c98124b485099f6d71e55e6329f362681e486b56"></a><a id="t.7"></a><table class="c15"><tr class="c3"><td class="c34" colspan="1" rowspan="1"><p class="c4"><span class="c0">//creating topic programmatically with KafkaAdmin&amp;AdminClient</span></p><p class="c4"><span class="c0">@Bean</span></p><p class="c4"><span class="c0">&nbsp;NewTopic myTopic() {</span></p><p class="c4"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; var props = new HashMap&lt;String, String&gt;();</span></p><p class="c4"><span>&nbsp; &nbsp; &nbsp; &nbsp; props.put(&quot;</span><span class="c2">compression.type</span><span>&quot;, &quot;</span><span class="c2">producer</span><span class="c0">&quot;);</span></p><p class="c4"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; NewTopic newTopic = new NewTopic(brokerProperties.getTopicName(), 1, (short) 1);</span></p><p class="c4"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; newTopic.configs(props);</span></p><p class="c4"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; return newTopic; </span></p><p class="c4"><span class="c0">}</span></p></td></tr></table><p class="c7 c9"><span class="c0"></span></p><p class="c7"><span class="c0">Decompression is done implicitly on the consumer side, so we always see a decompressed message, no additional configuration required.</span></p><p class="c7 c9"><span class="c0"></span></p><p class="c7"><span class="c0">Compression types</span></p><p class="c7"><span class="c26"><a class="c1" href="https://www.google.com/url?q=https://developer.ibm.com/articles/benefits-compression-kafka-messaging/&amp;sa=D&amp;source=editors&amp;ust=1657548662476365&amp;usg=AOvVaw1CZdXihHvULzCOUUrHuFPO">https://developer.ibm.com/articles/benefits-compression-kafka-messaging/</a></span><span class="c0">&nbsp;</span></p><h2 class="c11" id="h.cdop8vo5tlw9"><span class="c23 c24">Useful commands</span></h2><p class="c7"><span class="c0">Create topic</span></p><p class="c7"><span class="c12 c2">kafka-topics --create --bootstrap-server localhost:9092 --replication-factor 1 --partitions 1 --topic test-topic --config compression.type=(gzip|snappy|lz4|zstd)</span></p><p class="c7 c9"><span class="c0"></span></p><p class="c7"><span class="c0">Send to topic</span></p><p class="c7"><span class="c12 c2">kafka-console-producer --bootstrap-server localhost:9092 --topic test-topic &lt; ~/test-1.file</span></p><p class="c7 c9"><span class="c0"></span></p><p class="c7"><span class="c0">Modify existing topic config:</span></p><p class="c7"><span class="c2">kafka-configs --bootstrap-server localhost:9092 --entity-type topics --entity-name test-topic --alter --add-config compression.type=gzip</span></p><p class="c7 c9"><span class="c0"></span></p><p class="c7"><span class="c0">List log files and partitions (+ its size) for the topics:</span></p><p class="c7"><span class="c12 c2">kafka-log-dirs --describe --bootstrap-server 127.0.0.1:9092 --topic-list test-topic</span></p><a id="t.582c59e01a9216c8281b7483511088cb417a29dc"></a><a id="t.8"></a><table class="c15"><tr class="c3"><td class="c34" colspan="1" rowspan="1"><p class="c4"><span class="c6">{&quot;version&quot;:1,&quot;brokers&quot;:[{&quot;broker&quot;:1,&quot;logDirs&quot;:[{&quot;logDir&quot;:&quot;/var/lib/kafka/data&quot;,&quot;error&quot;:null,&quot;partitions&quot;:[{&quot;partition&quot;:&quot;test-topic-0&quot;,&quot;size&quot;:235,&quot;offsetLag&quot;:0,&quot;isFuture&quot;:false}]}]}]}</span></p></td></tr></table><p class="c7 c9"><span class="c0"></span></p><p class="c7"><span class="c0">List all the topics:</span></p><p class="c7"><span>root@dcf52f5bbab6:/bin# </span><span class="c2">kafka-topics --bootstrap-server localhost:9092 --list</span></p><a id="t.60437d29b090d839967422221353483012226d4a"></a><a id="t.9"></a><table class="c15"><tr class="c3"><td class="c34" colspan="1" rowspan="1"><p class="c4"><span class="c6">__confluent.support.metrics</span></p><p class="c4"><span class="c6">__consumer_offsets</span></p><p class="c4"><span class="c6">large-file-chunks-topic</span></p></td></tr></table><p class="c7 c9"><span class="c0"></span></p><p class="c7"><span class="c0">Describe topic configs:</span></p><p class="c7"><span class="c12 c2">kafka-topics --describe --zookeeper localhost:2181 --topic large-file-chunks</span></p><a id="t.490bad8810fbe526c5e06e5cd3b73e406a772f0e"></a><a id="t.10"></a><table class="c15"><tr class="c3"><td class="c34" colspan="1" rowspan="1"><p class="c4"><span class="c6">Topic:large-file-chunks &nbsp; &nbsp;PartitionCount:1 &nbsp; &nbsp; &nbsp; &nbsp;ReplicationFactor:1 &nbsp; &nbsp; Configs:compression.type=producer,max.message.bytes=15728640</span></p><p class="c4"><span class="c6">&nbsp; &nbsp; &nbsp; &nbsp; Topic: large-file-chunks &nbsp; Partition: 0 &nbsp; &nbsp;Leader: 1 &nbsp; &nbsp; &nbsp; Replicas: 1 &nbsp; &nbsp; Isr: 1</span></p></td></tr></table><p class="c7 c9"><span class="c0"></span></p><p class="c7"><span class="c0">Check how the records are encrypted in a topic:</span></p><p class="c7"><span class="c12 c2">kafka-run-class kafka.tools.DumpLogSegments --files /var/lib/kafka/data/large-file-chunks-0/00000000000000000000.log --print-data-log | grep compresscodec</span></p><a id="t.98040b79c04fceeaf322eb9e89c6f3f17725b828"></a><a id="t.11"></a><table class="c15"><tr class="c3"><td class="c34" colspan="1" rowspan="1"><p class="c4"><span class="c29">baseOffset: 0 lastOffset: 0 count: 1 baseSequence: -1 lastSequence: -1 producerId: -1 producerEpoch: -1 partitionLeaderEpoch: 0 isTransactional: false isControl: false position: 0 CreateTime: 1636802822601 size: 2018164 magic: 2 </span><span class="c29 c2">compresscodec</span><span class="c6">: LZ4 crc: 972834431 isvalid: true</span></p><p class="c4"><span class="c29">baseOffset: 1 lastOffset: 1 count: 1 baseSequence: -1 lastSequence: -1 producerId: -1 producerEpoch: -1 partitionLeaderEpoch: 0 isTransactional: false isControl: false position: 2018164 CreateTime: 1636802852084 size: 2018164 magic: 2 </span><span class="c29 c2">compresscodec</span><span class="c6">: LZ4 crc: 780224980 isvalid: true</span></p><p class="c4"><span class="c29">baseOffset: 2 lastOffset: 2 count: 1 baseSequence: -1 lastSequence: -1 producerId: -1 producerEpoch: -1 partitionLeaderEpoch: 0 isTransactional: false isControl: false position: 4036328 CreateTime: 1636802853851 size: 2018164 magic: 2 </span><span class="c29 c2">compresscodec</span><span class="c6">: LZ4 crc: 1970859284 isvalid: true</span></p><p class="c4"><span class="c29">baseOffset: 3 lastOffset: 3 count: 1 baseSequence: -1 lastSequence: -1 producerId: -1 producerEpoch: -1 partitionLeaderEpoch: 0 isTransactional: false isControl: false position: 6054492 CreateTime: 1636802866257 size: 2018164 magic: 2 </span><span class="c29 c2">compresscodec</span><span class="c6">: LZ4 crc: 1087921445 isvalid: true</span></p></td></tr></table><h2 class="c11" id="h.8y9b0rw5zlkv"><span class="c23 c24">Large messages </span></h2><p class="c7"><span class="c0">The message max size is 1MB (the setting in your brokers is called message. max. bytes ) Apache Kafka. If you really needed it badly, you could increase that size and make sure to increase the network buffers for your producers and consumers.</span></p><p class="c7 c9"><span class="c0"></span></p><p class="c7"><span class="c0">Step &#8470;1: Broker/topic configuration</span></p><p class="c7"><span class="c0">We could allow all topics on a Broker to accept messages of greater than 1MB in size by setting the broker property:</span></p><p class="c7"><span class="c2">message.max.bytes</span><span class="c0">=20971520 (env prop for cp-kafka: KAFKA_MESSAGE_MAX_BYTES)</span></p><p class="c7 c9"><span class="c0"></span></p><p class="c7"><span class="c0">But it is better to set a limit per topic (at topic-level):</span></p><p class="c7"><span class="c0">./kafka-topics.sh --bootstrap-server localhost:9092 --create --topic longMessage --partitions 1 \</span></p><p class="c7"><span>--replication-factor 1 --config </span><span class="c2">max.message.bytes</span><span class="c0">=20971520 </span></p><p class="c7 c9"><span class="c0"></span></p><p class="c7"><span class="c0">Additional property for replication (not mandatory)</span></p><p class="c7"><span style="overflow: hidden; display: inline-block; margin: 0.00px -0.00px; border: 2.67px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 456.50px; height: 220.28px;"><img alt="" src="images/image13.png" style="width: 456.50px; height: 220.28px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c7 c9"><span class="c0"></span></p><p class="c7"><span class="c0">Step &#8470;2: Producer configuration</span></p><p class="c7"><span>The property &ldquo;</span><span class="c2">max.request.size</span><span class="c0">&rdquo; needs to be set for producer configuration (ProducerConfig.MAX_REQUEST_SIZE_CONFIG in the Kafka Client library):</span></p><p class="c7"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 2.67px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 633.50px; height: 188.41px;"><img alt="" src="images/image17.png" style="width: 633.50px; height: 188.41px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c7"><span class="c0">This setting controls the size of a produce request sent by the producer. It caps both the size of the largest message that can be sent and the number of messages that the producer can send in one request. For example, with a default maximum request size of 1 MB, the largest message you can send is 1MB or the producer can batch 1000 messages of size 1k each into one request.</span></p><p class="c7 c9"><span class="c0"></span></p><a id="t.a04c28a37c5c9f817509a9a635c0464d053608f1"></a><a id="t.12"></a><table class="c15"><tr class="c3"><td class="c34" colspan="1" rowspan="1"><p class="c4"><span class="c23 c21">public ProducerFactory&lt;String, String&gt; producerFactory() {</span></p><p class="c4"><span class="c23 c21">&nbsp; &nbsp; Map&lt;String, Object&gt; configProps = new HashMap&lt;&gt;();</span></p><p class="c4"><span class="c23 c21">&nbsp; &nbsp; configProps.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapAddress);</span></p><p class="c4"><span class="c23 c21">&nbsp; &nbsp; configProps.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class);</span></p><p class="c4"><span class="c23 c21">&nbsp; &nbsp; configProps.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class);</span></p><p class="c4"><span class="c21">&nbsp; &nbsp; configProps.put(ProducerConfig.</span><span class="c2 c21">MAX_REQUEST_SIZE_CONFIG</span><span class="c21 c23">, &quot;20971520&quot;);</span></p><p class="c4 c9"><span class="c23 c21"></span></p><p class="c4"><span class="c23 c21">&nbsp; &nbsp; return new DefaultKafkaProducerFactory&lt;&gt;(configProps);</span></p><p class="c4"><span class="c23 c21">}</span></p></td></tr></table><p class="c7 c9"><span class="c0"></span></p><p class="c7"><span class="c0">Or using application properties (applied in KafkaAutoConfiguration):</span></p><a id="t.cbdf618ac49433e8c9b07f68b3ff0a9bebc7fe2b"></a><a id="t.13"></a><table class="c15"><tr class="c3"><td class="c34" colspan="1" rowspan="1"><p class="c4"><span class="c23 c21">spring.kafka:</span></p><p class="c4"><span class="c23 c21">&nbsp; &nbsp; &nbsp; &nbsp; producer:</span></p><p class="c4"><span class="c23 c21">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; key-serializer: org.apache.kafka.common.serialization.StringSerializer</span></p><p class="c4"><span class="c23 c21">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value-serializer: org.apache.kafka.common.serialization.ByteArraySerializer</span></p><p class="c4"><span class="c23 c21">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &hellip;</span></p><p class="c4"><span class="c23 c21">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; properties:</span></p><p class="c4"><span class="c23 c21">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; max-request-size: 15728640</span></p></td></tr></table><p class="c7 c9"><span class="c0"></span></p><p class="c7"><span class="c0">Step &#8470;3: Consumer configuration</span></p><p class="c7"><span class="c0">Consumer configuration isn&rsquo;t mandatory for consuming large messages, avoiding them can have a performance impact on the consumer application.</span></p><p class="c7"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 2.67px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 563.50px; height: 204.84px;"><img alt="" src="images/image2.png" style="width: 563.50px; height: 204.84px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c7"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 2.67px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 565.50px; height: 187.51px;"><img alt="" src="images/image3.png" style="width: 565.50px; height: 187.51px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><h2 class="c11" id="h.p5z9bnmk3cj"><span class="c23 c24">li-apache-kafka-clients</span></h2><p class="c7"><span class="c26"><a class="c1" href="https://www.google.com/url?q=https://github.com/linkedin/li-apache-kafka-clients&amp;sa=D&amp;source=editors&amp;ust=1657548662486751&amp;usg=AOvVaw35SPAF5qW_A7d7H9rCvqiA">https://github.com/linkedin/li-apache-kafka-clients</a></span></p><p class="c7"><span class="c0">li-apache-kafka-clients is a wrapper Kafka clients library built on top of vanilla Apache Kafka clients.</span></p><p class="c7 c9"><span class="c0"></span></p><p class="c7"><span class="c0">Large message support</span></p><p class="c7"><span>Like many other messaging systems, Kafka has a maximum message size limit for a few reasons (e.g. memory management. Due to the message size limit, in some cases, user have to bear with small amount of message loss or involve external storage to store the large objects. li-apache-kafka-clients addresses this problem with a </span><span class="c2">solution that does not require an external storage dependency</span><span class="c0">. For users who are storing offsets checkpoints in Kafka, li-apache-kafka-clients handles large messages almost transparently.</span></p><p class="c7 c9"><span class="c0"></span></p><p class="c7"><span class="c0">large.message.enabled</span></p><p class="c7"><span class="c0">max.message.segment.bytes</span></p><p class="c7"><span class="c0">segment.serializer</span></p><p class="c7 c9"><span class="c0"></span></p><p class="c7"><span>If </span><span class="c2">large.message.enabled</span><span>=true, LiKafkaProducerImpl will split the messages whose serialized size is greater than </span><span class="c2">max.message.segment.bytes</span><span>&nbsp;into multiple LargeMessageSegment, serialize each LargeMessageSegment with the specified </span><span class="c2">segment.serializer</span><span class="c0">&nbsp;and send the serialized segments to Kafka brokers.</span></p><p class="c7 c9"><span class="c0"></span></p><p class="c7 c9"><span class="c0"></span></p></body></html>